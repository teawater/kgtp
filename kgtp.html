<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.0 Transitional//EN">
<html>
<head>
	<meta http-equiv="content-type" content="text/html; charset=utf-8">
	<title>Linux Kernel GDB tracepoint module (KGTP)</title>
	<meta name="generator" content="LibreOffice 4.2.3.3 (Linux)">
	<meta name="author" content="teawater ">
	<meta name="created" content="20130710;155757000000000">
	<meta name="changed" content="20140509;170947997149105">
<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-581509-4', 'teawater.github.io');
ga('send', 'pageview');

</script>
	<style type="text/css">
	<!--
		@page { margin: 2cm }
		p { margin-bottom: 0.21cm; font-size: 12pt }
		h1 { margin-bottom: 0.21cm }
		h1.western { font-family: "DejaVu Sans", sans-serif; font-size: 36pt }
		h1.cjk { font-family: "DejaVu Sans"; font-size: 36pt }
		h1.ctl { font-family: "Lohit Hindi"; font-size: 16pt }
		td p { margin-bottom: 0cm }
		h2 { margin-top: 0.42cm }
		h2.western { font-family: "DejaVu Serif", serif; font-size: 24pt }
		h2.cjk { font-family: "DejaVu Sans"; font-size: 24pt }
		h2.ctl { font-family: "Lohit Hindi" }
		h3 { margin-top: 0.42cm; color: #000000 }
		h3.western { font-family: "DejaVu Serif", serif; font-size: 18pt }
		h3.cjk { font-family: "DejaVu Sans"; font-size: 18pt }
		h3.ctl { font-family: "Lohit Hindi" }
		h4 { margin-top: 0.42cm; color: #000000 }
		h4.western { font-family: "DejaVu Sans", sans-serif; font-size: 15pt; font-style: normal }
		h4.cjk { font-family: "DejaVu Sans"; font-size: 15pt; font-style: normal }
		h4.ctl { font-family: "Lohit Hindi"; font-size: 11pt; font-style: italic }
		h5 { margin-top: 0.42cm; margin-bottom: 0.21cm }
		h5.western { font-family: "DejaVu Sans", sans-serif; font-size: 14pt }
		h5.cjk { font-family: "DejaVu Sans"; font-size: 14pt }
		h5.ctl { font-family: "Lohit Hindi"; font-size: 11pt }
		blockquote { margin-bottom: 0cm; color: #0000ff; page-break-before: auto }
		blockquote.western { font-size: 12pt; font-style: italic }
		blockquote.cjk { font-size: 12pt; font-style: oblique }
		blockquote.ctl { font-size: 12pt }
		h6 { margin-top: 0.42cm; margin-bottom: 0.21cm }
		h6.western { font-family: "DejaVu Sans", sans-serif; font-size: 10pt }
		h6.cjk { font-family: "DejaVu Sans"; font-size: 10pt }
		h6.ctl { font-family: "Lohit Hindi"; font-size: 10pt }
		a:link { so-language: zxx }
		kbd { font-family: "DejaVu Sans Mono", monospace }
	-->
	</style>
</head>
<body lang="zh-CN" dir="ltr">
<div title="header">
	<p style="margin-bottom: 0.5cm"><sdfield type=DOCINFO subtype=THEME></sdfield></p>
</div>
<h1 class="cjk" align="center"></h1>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<p align="center" style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="7" style="font-size: 42pt"><span lang="en-US"><b>Linux
Kernel GDB tracepoint module</b></span></font></font></p>
<p align="center" style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="7" style="font-size: 42pt"><span lang="en-US"><b>(KGTP)</b></span></font></font></p>
<p align="center" style="margin-bottom: 0cm"><br>
</p>
<p align="center"><br><br>
</p>
<p align="center"><font face="DejaVu Serif, serif"><span lang="en-US">Update
in 2014-05-09</span></font></p>
<p align="center"><br><br>
</p>
<p align="center"><br><br>
</p>
<div id="内容目录1" dir="ltr" style="background: transparent">
	<div id="内容目录1_Head" dir="ltr">
		<p style="margin-bottom: 0cm; page-break-before: always; page-break-after: avoid">
		<font face="DejaVu Sans, sans-serif"><font size="4" style="font-size: 16pt"><span lang="en-US"><b>TOC</b></span></font></font></p>
	</div>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10569_680043226">About
	this document	6</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10571_680043226">What
	is KGTP	7</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__11364_1305468286">Quick
	config and start KGTP	8</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__11582_1935127565">Get
	help or report issues	10</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__621_1585187435">Table
	of different between GDB debug normal program and KGTP	11</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4834_1369842245">Howto
	use GDB control KGTP trace and debug Linux kernel	14</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4836_1369842245">Direct
	access the current value in normal mode	14</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4457_907387813">The
	memory of Linux kernel	14</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4461_907387813">the
	trace state variables	16</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4463_907387813">GDB
	tracepoint	17</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4723_907387813">set
	tracepoint	18</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4725_907387813">Howto
	handle the function is there but set tracepoint on it got fail	19</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4727_907387813">How
	to set tracepoint condition	20</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4729_907387813">How
	to handle error &quot;Unsupported operator (null) (52) in
	expression.&quot;	21</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4731_907387813">actions
	[num]	22</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4733_907387813">collect
	expr1, expr2, ...	23</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5112_907387813">teval
	expr1, expr2, ...	24</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5114_907387813">while-stepping
	n	25</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5116_907387813">Start
	and stop the tracepoint	26</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5118_907387813">Enable
	and disable the tracepoint	27</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5120_907387813">Use
	tfind select the entry inside the trace frame info	28</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5122_907387813">How
	to handle error &quot;No such file or directory.&quot;	29</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5124_907387813">Save
	the trace frame info to a file	30</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5126_907387813">Show
	and save the tracepoint	31</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5128_907387813">Delete
	tracepoint	32</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5130_907387813">Use
	tracepoint get register info from a point of kernel	33</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5919_907387813">Use
	tracepoint get the value of variable from a point of kernel	35</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5921_907387813">Show
	all the traced data of current frame	36</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5923_907387813">Get
	status of tracepoint	37</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5925_907387813">Set
	the trace buffer into a circular buffer	38</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5927_907387813">Do
	not stop tracepoint when the GDB disconnects	39</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5929_907387813">kprobes-optimization
	and the execution speed of tracepoint	39</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5931_907387813">How
	to use trace state variables	40</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5933_907387813">Simple
	trace state variables	41</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5935_907387813">Per_cpu
	trace state variables	43</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5937_907387813">How
	to define	44</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5939_907387813">Local
	CPU variables	44</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5941_907387813">CPU
	id variables	44</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5943_907387813">Example
	1	45</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5945_907387813">Example
	2	46</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5947_907387813">Special
	trace state variables $current_task, $current_task_pid,
	$current_thread_info, $cpu_id, $dump_stack, $printk_level,
	$printk_format, $printk_tmp ,$clock, $hardirq_count, $softirq_count
	and $irq_count	47</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7575_907387813">Special
	trace state variable $self_trace	50</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7577_907387813">Trace
	the function return with $kret	51</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7579_907387813">Use
	$ignore_error and $last_errno to ignore the error of tstart	52</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7581_907387813">Use
	$cooked_clock and $cooked_rdtsc the time without KGTP used	53</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7583_907387813">Use
	$xtime_sec and $xtime_nsec get the timespec	54</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7585_907387813">Howto
	backtrace (stack dump)	55</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7587_907387813">Collect
	stack with $bt and use GDB command &quot;backtrace&quot;	56</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7589_907387813">Collect
	stack of current function's caller with $_ret	59</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7591_907387813">Use
	$dump_stack to output stack dump through printk	61</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7593_907387813">Howto
	let tracepoint output value directly	63</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7595_907387813">Switch
	collect to output the value directly	63</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7597_907387813">Howto
	use watch tracepoint control hardware breakpoints to record memory
	access	65</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7599_907387813">Trace
	state variables of watch tracepoint	65</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7601_907387813">Static
	watch tracepoint	68</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7603_907387813">Dynamic
	watch tracepoint	69</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__7605_907387813">Use
	while-stepping let Linux kernel do single step	70</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9329_907387813">Howto
	use while-stepping	70</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9331_907387813">Read
	the traceframe of while-stepping	71</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9333_907387813">Howto
	show a variable whose value has been optimized away	73</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9335_907387813">Update
	your GCC	73</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9337_907387813">Get
	the way that access the variable that has been out through parse ASM
	code	74</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9339_907387813">How
	to get the function pointer point to	77</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9341_907387813">If
	the debug info of the function pointer is not optimized out	77</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9343_907387813">If
	the debug info of the function pointer is optimized out	78</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9345_907387813">/sys/kernel/debug/gtpframe
	and offline debug	79</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9347_907387813">How
	to use /sys/kernel/debug/gtpframe_pipe	81</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9349_907387813">Get
	the frame info with GDB	82</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9351_907387813">Get
	the frame info with cat	83</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9353_907387813">Get
	the frame info with getframe	84</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9355_907387813">Use
	$pipe_trace	85</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9357_907387813">Use
	KGTP with user applications	86</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5676_1661268449">Let
	GDB connect KGTP for user applications	86</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5678_1661268449">Read
	memory of user applications directly	87</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__5680_1661268449">Trace
	user applications	88</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9361_907387813">collect
	stack (for backtrace) of system from Linux kernel to user
	applications in tracepoint	90</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9363_907387813">How
	to use add-ons/hotcode.py	93</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9365_907387813">How
	to add plugin in C	94</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9367_907387813">API	94</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9369_907387813">Example	96</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9371_907387813">How
	to use	97</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9373_907387813">How
	to use performance counters	98</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9375_907387813">Define
	a perf event trace state variable	99</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9377_907387813">Define
	a per_cpu perf event trace state variable	100</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9379_907387813">The
	perf event type and config	101</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9381_907387813">Enable
	and disable all the perf event in a CPU with $p_pe_en	103</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__9383_907387813">GDB
	scripts to help with set and get the perf event trace state
	variables</a><a href="#__RefHeading__9383_907387813">	104</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__11428_1305468286">Appendix
	A Preparatory work before use KGTP	107</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__625_1585187435">Linux
	kernel	107</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__627_1585187435">If
	your system use the Linux kernel that is built by yourself	107</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__629_1585187435">If
	use with Linux kernel of Android	108</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__631_1585187435">If
	your system use the Linux kernel from distribution	109</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__882_1585187435">Ubuntu	109</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__884_1585187435">The
	standard method of install the Linux kernel debug image	109</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__886_1585187435">The
	second method of install the Linux kernel debug image	110</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__888_1585187435">Install
	the Linux kernel headers	110</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__890_1585187435">Install
	the Linux kernel source	110</a></span></font></font></p>
	<p style="margin-left: 2.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10573_680043226">New
	way	110</a></span></font></font></p>
	<p style="margin-left: 2.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10575_680043226">Old
	way	110</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4078_695897485">Fedora	111</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4080_695897485">Install
	the Linux kernel debug image	111</a></span></font></font></p>
	<p style="margin-left: 2cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4082_695897485">Install
	the Linux kernel devel package	111</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4084_695897485">Make
	sure current Linux kernel debug image is right	112</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4086_695897485">Where
	is the current Linux kernel debug image	112</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4088_695897485">Use
	/proc/kallsyms	113</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4090_695897485">Use
	linux_banner	114</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4092_695897485">Handle
	the issue that Linux kernel debug image's address info is not same
	with Linux kernel when it running	115</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4094_695897485">Get
	KGTP	116</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4096_695897485">Get
	KGTP through http	116</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4098_695897485">Get
	KGTP through git	117</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10684_1267614711">Mirrors	118</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4748_695897485">Config
	KGTP	119</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4750_695897485">Compile
	KGTP	120</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4752_695897485">Normal
	compile	120</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4754_695897485">Compile
	KGTP with some special config	121</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4756_695897485">Install
	and uninstall KGTP	122</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4427_1176671169">Use
	KGTP with DKMS	123</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4429_1176671169">Use
	KGTP patch for Linux kernel	124</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4431_1176671169">Install
	GDB for KGTP	125</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4433_1176671169">Appendix
	B How to let GDB connect to KGTP	126</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4435_1176671169">Normal
	Linux	126</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4437_1176671169">Insmod
	the KGTP module	126</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4439_1176671169">Handle
	the issue that cannot find &quot;/sys/kernel/debug/gtp&quot;	127</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4283_1369842245">Make
	GDB connect to gtp	128</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__10764_1675807557">Load
	Linux kernel debug image to GDB	128</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4816_1369842245">GDB
	on the current machine	129</a></span></font></font></p>
	<p style="margin-left: 1.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4818_1369842245">GDB
	on remote machine	130</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4820_1369842245">Android	131</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4822_1369842245">Insmod
	the KGTP module	131</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4824_1369842245">Handle
	the issue that cannot find &quot;/sys/kernel/debug/gtp&quot;	132</a></span></font></font></p>
	<p style="margin-left: 1cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4826_1369842245">GDB
	connect to the KGTP	133</a></span></font></font></p>
	<p style="margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4828_1369842245">Appendix
	C Add module symbols to GDB	134</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4830_1369842245">How
	to use getmod	134</a></span></font></font></p>
	<p style="margin-left: 0.5cm; margin-bottom: 0cm"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#__RefHeading__4832_1369842245">How
	to use getmod.py	136</a></span></font></font></p>
</div>
<h1 class="cjk" align="left" style="font-variant: normal"><br><br>
</h1>
<h1 class="cjk" align="left" style="font-variant: normal; page-break-before: always"><a name="__RefHeading__10569_680043226"></a>
<font color="#000000"><font face="arial, sans-serif"><font size="7" style="font-size: 36pt"><span lang="en-US">About
this document</span></font></font></font></h1>
<p align="left" style="font-variant: normal"><font color="#000000"><font face="arial, sans-serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="http://teawater.github.io/kgtp/kgtp.html">http://teawater.github.io/kgtp/kgtp.html</a>
is the the last version of this document in HTML format.</span></font></font></font></p>
<p align="left" style="font-variant: normal"><font color="#000000"><font face="arial, sans-serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="https://raw.github.com/teawater/kgtp/master/kgtp.pdf">https://raw.github.com/teawater/kgtp/master/kgtp.pdf</a>
is the the last version of this document in PDF format.</span></font></font></font></p>
<p align="left" style="font-variant: normal"><font color="#000000"><font face="arial, sans-serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="https://raw.github.com/teawater/kgtp/release/kgtp.pdf">https://raw.github.com/teawater/kgtp/release/kgtp.pdf</a>
is the the last release version of this document in PDF format.</span></font></font></font></p>
<h1 class="cjk" align="left" style="font-variant: normal; page-break-before: always"><a name="__RefHeading__10571_680043226"></a>
<font color="#000000"><font face="arial, sans-serif"><font size="7" style="font-size: 36pt"><span lang="en-US">What
is KGTP</span></font></font></font></h1>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US"><b>KGTP</b>
is a comprehensive dynamic tracer for analysing Linux kernel and
application (including Android) problems on production systems in
real time.</span></font></p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">To
use it, you don't need patch or rebuild the Linux kernel. Just build
KGTP module and insmod it is OK.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">It makes Linux
Kernel supply a GDB remote debug interface. Then GDB in current
machine or remote machine can debug and trace Linux kernel and user
space program through GDB tracepoint and some other functions without
stopping the Linux Kernel.</span></font></p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">And
even if the board doesn't have GDB on it and doesn't have interface
for remote debug. It can debug the Linux Kernel using offline debug
(See <a href="#/sys/kernel/debug/gtpframe and offline debug|outline">/sys/kernel/debug/gtpframe
and offline debug</a>).</span></font></p>
<p align="left"><br><br>
</p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US"><a href="http://www.youtube.com/watch?v=7nfGAbNsEZY">http://www.youtube.com/watch?v=7nfGAbNsEZY</a>
or <a href="http://www.tudou.com/programs/view/fPu_koiKo38/">http://www.tudou.com/programs/view/fPu_koiKo38/</a>
is the video that introduced KGTP in <b>English</b>. </span></font>
</p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US"><a href="http://www.infoq.com/cn/presentations/gdb-sharp-knife-kgtp-linux-kernel">http://www.infoq.com/cn/presentations/gdb-sharp-knife-kgtp-linux-kernel</a>
is the video that introduced KGTP in <b>Chinese</b>.</span></font></p>
<p align="left"><br><br>
</p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">KGTP
supports <b>X86-32</b>, <b>X86-64</b>, <b>MIPS</b> and <b>ARM</b>.</span></font></p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">KGTP
supports  most versions of Linux kernel (from <b>2.6.18</b> to
<b>upstream</b><span style="font-weight: normal">).</span></span></font></p>
<p align="left"><br><br>
</p>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">Please
go to <a href="https://github.com/teawater/kgtp/blob/master/UPDATE">UPDATE</a>
to get more info about KGTP update.</span></font></p>
<h1 class="cjk" align="left" style="font-variant: normal; page-break-before: always; page-break-after: avoid"><a name="__RefHeading__11364_1305468286"></a><a name="Quick config and start KGTP|outline"></a>
<font color="#000000"><font face="arial, sans-serif"><span lang="en-US">Quick
config and start KGTP</span></font></font></h1>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#kgtp.py
will auto setup and start KGTP and GDB in current machine. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#The
first time you use this script needs to wait for a while because
there are some packages to download. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>wget
https://raw.githubusercontent.com/teawater/kgtp/master/kgtp.py </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
python kgtp.py </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Access
memory of Linux kernel. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p jiffies_64 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$2
= 5081634360 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Set
tracepoint in function vfs_read to collect its backtrace. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff811b8c70: file fs/read_write.c, line 382. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
vfs_read (file=file@entry=0xffff88022017b000, </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>buf=buf@entry=0x7fff0fdd80f0
&lt;Address 0x7fff0fdd80f0 out of bounds&gt;, </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>count=count@entry=16,
pos=pos@entry=0xffff8800626aff50) at fs/read_write.c:382 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>382
{ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
vfs_read (file=file@entry=0xffff88022017b000, </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>buf=buf@entry=0x7fff0fdd80f0
&lt;Address 0x7fff0fdd80f0 out of bounds&gt;, </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>count=count@entry=16,
pos=pos@entry=0xffff8800626aff50) at fs/read_write.c:382 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
0xffffffff811b9819 in SYSC_read (count=16, </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>buf=0x7fff0fdd80f0
&lt;Address 0x7fff0fdd80f0 out of bounds&gt;, fd=&lt;optimized out&gt;)
</i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
fs/read_write.c:506</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please read
<a href="#5.Appendix A Preparatory work before use KGTP|outline">Appendix
A Preparatory work before use KGTP</a> and <a href="#6.Appendix B How to let GDB connect to KGTP|outline">Appendix
B </a><a href="#6.Appendix B How to let GDB connect to KGTP|outline">How
to let GDB connect to KGTP</a> if you want to use KGTP in remore
machine or android.</span></font></p>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p style="font-variant: normal"><br><br>
</p>
<h1 class="cjk" style="font-variant: normal"><br><br>
</h1>
<h1 class="cjk" style="font-variant: normal; page-break-before: always"><a name="__RefHeading__11582_1935127565"></a>
<font color="#000000"><font face="arial, sans-serif"><span lang="en-US">Get
help or report issues</span></font></font></h1>
<p align="left" style="margin-top: 0.42cm"><font face="DejaVu Serif, serif"><span lang="en-US">Please
post issues to to <a href="https://github.com/teawater/kgtp/issues">https://github.com/teawater/kgtp/issues</a>.</span></font></p>
<p align="left" style="margin-top: 0.42cm"><font face="DejaVu Serif, serif"><span lang="en-US">Or
mail them to
<a href="mailto:teawater@gmail.com?Subject=Report%20an%20issue%20of%20KGTP">mailto:teawater@gmail.com?Subject=Report%20an%20issue%20of%20KGTP</a>.</span></font></p>
<p align="left" style="margin-top: 0.42cm"><font face="DejaVu Serif, serif"><span lang="en-US">Or
report it to QQ group <b>317654748</b>.</span></font></p>
<p align="left" style="margin-top: 0.42cm"><font face="DejaVu Serif, serif"><span lang="en-US">The
KGTP team will try our best to help you.</span></font></p>
<p align="left" style="margin-top: 0.42cm"><font face="DejaVu Serif, serif"><span lang="en-US">Please
goto <a href="https://code.google.com/p/kgtp/issues/list">https://code.google.com/p/kgtp/issues/list</a>
access the old issues list.</span></font></p>
<p align="left"><br><br>
</p>
<h1 class="cjk" align="left" style="font-variant: normal; page-break-before: always"><a name="__RefHeading__621_1585187435"></a><a name="3.Get help or report issues about KGTP|outline"></a>
<font color="#000000"><font face="arial, sans-serif"><font size="7" style="font-size: 36pt"><span lang="en-US">Table
of different between GDB debug normal program and KGTP</span></font></font></font></h1>
<p align="left"><font face="DejaVu Serif, serif"><span lang="en-US">This
table is for the people that have experience using GDB debug normal
program. It will help you understand and remember the function of
KGTP.</span></font></p>
<table width="643" cellpadding="4" cellspacing="0">
	<col width="144">
	<col width="267">
	<col width="206">
	<tr valign="top">
		<td width="144" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US"><strong><span style="font-variant: normal"><font color="#000000"><font face="arial, sans-serif"><font size="3" style="font-size: 12pt"><span style="font-style: normal"><b>Function</b></span></font></font></font></span></strong></span></font></p>
		</td>
		<td width="267" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><b>GDB
			debug normal program</b></span></font></font></p>
		</td>
		<td width="206" style="border: 1px solid #000000; padding: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><b>GDB
			control KGTP debug Linux kernel</b></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Preparatory
			work</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">Have
			a GDB installed in your system.  Program built with &quot;-g&quot;.</span></font></font></p>
		</td>
		<td rowspan="2" width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US"><a href="#Quick config and start KGTP|outline">Quick
			config and start KGTP</a></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Attach</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">Use
			command &quot;gdb -p pid&quot; or GDB command &quot;attach pid&quot;
			can attach a program that running in the system.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Breakpoints</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">GDB
			command &quot;b place_will_stop&quot;, let program execute after
			this command. Then programe will stop in the place that setup a
			breakpoint.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">KGTP
			doesn't support breakpoints but it support tracepoints.
			Tracepoints can be considered as a special kind of breakpoints. It
			can be setup in some place of Linux kernel and define some
			commands that you want to do in its actions. When tracepoints
			start, they will execute these commands when Linux kernel execute
			to these place. When tracepoint stop, you can use some GDB
			commands parse the data that get by tracepoints like what you do
			when program stop by breakpoints. <b>Difference</b> is breakpoints
			will stop the program But the tracepoints of KGTP not. Please goto
			<a href="#GDB tracepoint |outline">GDB tracepoint</a> get howto
			use it.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Memory read</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">After
			GDB stop the program(maybe doesn't need), it can read memory of
			program with GDB command &quot;print&quot;, &quot;x&quot; and so
			on.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">You
			can set special actions to collect memory to traceframe in
			tracepoints, and get the its value when tracepoint stop.<a href="#8.0.0.3.collect expr1, expr2, ... |outline">collect
			expr1, expr2, ...</a> <a href="#Use tfind select the entry inside the trace frame info |outline">Use
			tfind select the entry inside the trace frame info</a> </span></font></font>
			</p>
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">Or
			you can read memory directly when Linux kernel or program is
			running.<a href="#Direct access the current value in normal mode |outline">Direct
			access the current value in normal mode</a></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Step and
			continue</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">GDB
			can continue program execution with command &quot;continue&quot;
			and stop it with CTRL-C.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">KGTP
			never stop the Linux kernel. But tracepoint can be start and
			stop.<a href="#Start and stop the tracepoint |outline">Start and
			stop the tracepoint</a> </span></font></font>
			</p>
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">Or
			use while-stepping tracepoint record Linux kernel with some times
			single step and Let KGTP switch to replay mode. Then it support
			execution commands (continue, step) and reverse-execute commands
			(reverse-continue, reverse-step). <a href="#Use while-stepping let Linux kernel do single step|outline">Use
			while-stepping let Linux kernel do single step</a></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Backtrace</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">GDB
			can print backtrace of all stack frames with command &quot;backtrace&quot;.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">KGTP
			can do it too.<a href="#Howto backtrace (stack dump) |outline">Howto
			backtrace (stack dump)</a></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Watchpoint</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">GDB
			can let programe stop when some memory access happen with
			watchpoint.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">KGTP
			can record the memory access with watch tracepoint. <a href="#Howto use watch tracepoint control hardware breakpoints to record memory access |outline">Howto
			use watch tracepoint control hardware </a><a href="#Howto use watch tracepoint control hardware breakpoints to record memory access |outline">breakpoints
			to record memory access</a></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="144" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><span lang="en-US">Call
			function</span></font></p>
		</td>
		<td width="267" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">GDB
			can call function of program with command &quot;call
			function(xx,xx)&quot;.</span></font></font></p>
		</td>
		<td width="206" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p align="left"><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">KGTP
			can call function of Linux kernel with plugin.<a href="#How to add plugin in C |outline">How
			to add plugin in C</a></span></font></font></p>
		</td>
	</tr>
</table>
<p align="left"><br><br>
</p>
<p><br><br>
</p>
<h1 class="cjk" style="page-break-before: always"><a name="__RefHeading__4834_1369842245"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Howto use GDB
control KGTP trace and debug Linux kernel </span></font>
</h1>
<h2 class="cjk"><a name="__RefHeading__4836_1369842245"></a><a name="Direct access the current value in normal mode | outline"></a><a name="Direct access the current value in normal mode |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Direct access the
current value in normal mode </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After GDB
connect to KGTP, if it doesn't select any a entry of trace frame
bufffer with GDB command &quot;tfind&quot;, GDB in the normal mode.
Then you can direct access the current value of memory (Linux kernel
or the user space program) and the trace state variables without stop
anything. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you have
selected a trace frame entry, use GDB command &quot;tfind -1&quot; to
return to normal mode. Please goto <a href="#Use tfind select the entry inside the trace frame info |outline">Use
tfind select the entry inside the trace frame info</a> info about GDB
command &quot;tfind&quot;. </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__4457_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">The
memory of Linux kernel </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example,
you can access to &quot;jiffies_64&quot; with following command: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p jiffies_64</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or you can
access to the first entry of &quot;static LIST_HEAD(modules)&quot;
with following command: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p *((struct module *)((char *)modules-&gt;next - ((size_t) &amp;(((struct
module *)0)-&gt;list)))) </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or you can
access to the CPU0 memory info of &quot;DEFINE_PER_CPU(struct device
*, mce_device);&quot;:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>p
*(struct device *)(__per_cpu_offset[0]+(uint64_t)(&amp;mce_device))</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want
show more than one variables with one GDB command, please use
following example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
printf &quot;%4d %4d %4d %4d %4d %4d %18d %lu\n&quot;, this_rq-&gt;cpu,
this_rq-&gt;nr_running, this_rq-&gt;nr_uninterruptible, nr_active,
calc_load_tasks-&gt;counter, this_rq-&gt;calc_load_active, delta,
this_rq-&gt;calc_load_update </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
1 0 0 0 0 673538312 717077240</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4461_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">the trace state
variables </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can access
value of TSV with the command that same with access memory. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
<a href="#How to use trace state variables | outline">How to use
trace state variables</a> get more info about TSV. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4463_907387813"></a><a name="GDB tracepoint |outline"></a><a name="GDB tracepoint |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">GDB tracepoint </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Tracepoint is
that GDB define some addresses and some actions and put them to the
target (KGTP). After tracepoint start, , KGTP will do these actions
(Some of them will collect data and save them to tracepoint frame
buffer) when Linux kernel execution to there addresses. After that,
Linux kernel will keep execution. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP supply
some interfaces that GDB or other programe can take the data of
tracepoint frame buffer out to parse. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">About these
interfaces, this doc have introduced &quot;/sys/kernel/debug/gtp&quot;.
And will introduce &quot;/sys/kernel/debug/gtpframe&quot; and
&quot;/sys/kernel/debug/gtpframe_pipe&quot; later. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Doc of GDB
tracepoint in
<a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Tracepoints.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Tracepoints.html</a>.
</span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4723_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">set tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The trace
command is very similar to the break command. Its argument location
can be a source line, a function name, or an address in the target
program. The trace command defines a tracepoint, which is a address
or some addresses that KGTP do some actions in it.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Here are some
examples of using the trace command: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace foo.c:121    // a source file and line number </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace +2           // 2 lines forward </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace my_function  // first source line of function </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace *my_function // EXACT start address of function </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace *0x2117c4    // an address </i></span></font>
</blockquote>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4725_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Howto handle
the function is there but set tracepoint on it got fail </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GCC will
inline some static function to increase the performance. You cannot
set tracepoint on the function name because object file doesn't have
symbol of inline function. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
&quot;trace filename:line&quot; to set tracepoint on it. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4727_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to set
tracepoint condition </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Tracepoint-Conditions.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Tracepoint-Conditions.html
</a></span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Like
breakpoints, we can set conditions on tracepoints. The speed of
tracepoints is faster than breakpoints because KGTP can do all the
condition checks.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace handle_irq if (irq == 47) </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This action of
tracepoint 1 will work only when irq number is 47. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">And you can
use GDB command &quot;condition&quot; to specify the condition of a
tracepoint. GDB command &quot;condition N COND&quot; will specify
tracepoint number N to trace only if COND is true. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace handle_irq </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition 1 (irq == 47) </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB command
&quot;info tracepoint&quot; will show the ID of the tracepoint. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Value of
$bpnum is the last ID of GDB tracepoint. Then you can use GDB command
&quot;condtion&quot; set the condition of last tracepoint without get
its ID. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace handle_irq </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition $bpnum (irq == 47)</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4729_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">How to handle
error &quot;Unsupported operator (null) (52) in expression.&quot; </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you use
condition about string, you will got this error when you call
&quot;tstart&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">To handle it,
you can convent the char to int to handle this issue, for example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p/x 'A' </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$4
= 0x41 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition 1 (buf[0] == 0x41)</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4731_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">actions [num] </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This command
will prompt for a list of actions to be taken when the tracepoint is
hit. If the tracepoint number num is not specified, this command sets
the actions for the one that was most recently defined (so that you
can define a tracepoint and then say actions without bothering about
its number). You specify the actions themselves on the following
lines, one action at a time, and terminate the actions list with a
line containing just end. So far, the only defined actions are
collect, teval, and while-stepping. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4733_907387813"></a><a name="collect expr1, expr2, ... |outline"></a><a name="8.0.0.3.collect expr1, expr2, ... |outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">collect
expr1, expr2, ... </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Collect values
of the given expressions when the tracepoint is hit. This command
accepts a comma-separated list of any valid expressions. In addition
to global, static, or local variables, the following special
arguments are supported: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$regs
  Collect all registers. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$args
  Collect all function arguments. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$locals
Collect all local variables. </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that collect an pointer (collect ptr) will just collect the address
of this pointer. Add a * before ptr will make action collect the data
that pointer point to(collect *ptr). </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5112_907387813"></a><a name="teval expr1, expr2, ... |outline"></a><a name="8.0.0.4.teval expr1, expr2, ... |outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">teval expr1,
expr2, ... </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Evaluate the
given expressions when the tracepoint is hit. This command accepts a
comma-separated list of expressions. The results are discarded, so
this is mainly useful for assigning values to trace state variables
(see <a href="#Simple trace state variables | outline">Simple trace
state variables</a>) without adding those values to the trace buffer,
as would be the case if the collect action were used. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5114_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">while-stepping
n </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
<a href="#Use while-stepping let Linux kernel do single step | outline">Use
while-stepping let Linux kernel do single step</a> see howto use it. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5116_907387813"></a><a name="Start and stop the tracepoint |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Start and stop
the tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Tracepoint
will exec actions only when it is starting use this GDB command: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">It will stop
by this GDB command:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5118_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Enable and
disable the tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Like
breakpoint, tracepoint can be control by GDB commands &quot;enable&quot;
and &quot;disable&quot;. But please <b>note</b> that it only useful
when tracepoint stop. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5120_907387813"></a><a name="Use tfind select the entry inside the trace frame info | outline"></a><a name="Use tfind select the entry inside the trace frame info |outline"></a><a name="Use tfind select the entry inside the trace frame info |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use tfind select
the entry inside the trace frame info </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB command
&quot;tfind&quot; is used to select a entry of trace frame bufffer
when tracepoint stop. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When GDB
inside &quot;tfind&quot; mode, it will just show the values of this
entry that the tracepoint action collect. So it will output some
error when print some values that action doesn't collect for example
the argument of function. That is not a bug, please don't worry about
it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use &quot;tfind&quot;
again will select next entry. &quot;tfind id&quot; will select entry
id. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">To return to
normal mode(<a href="#Direct access the current value in normal mode | outline">Direct
access the current value in normal mode</a>), please use GDB command
&quot;tfind -1&quot;. Please goto
<a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/tfind.html">http://sourceware.org/gdb/current/onlinedocs/gdb/tfind.html
</a>get more info about it. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5122_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">How to handle
error &quot;No such file or directory.&quot; </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When GDB
cannot find the source code of Linux kernel, it will show this error
message. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 1, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff8801c36e6400, buf=0x7fff51a8f110 &lt;Address
0x7fff51a8f110 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801761dff48)
at /build/buildd/linux-3.2.0/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    /build/buildd/linux-3.2.0/fs/read_write.c: No such file or
directory.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
GDB command &quot;set substitute-path&quot; to handle it. The prev
example, the Linux kernel source is in
&quot;/build/buildd/test/linux-3.2.0/&quot;. But vmlinux let GDB find
Linux kernel source in &quot;/build/buildd/linux-3.2.0/&quot;. You
can handle it with: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
set substitute-path /build/buildd/linux-3.2.0/
/build/buildd/test/linux-3.2.0/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 1, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff8801c36e6400, buf=0x7fff51a8f110 &lt;Address
0x7fff51a8f110 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801761dff48)
at /build/buildd/linux-3.2.0/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    {</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB have some
other commands to handle the source code issue. Please goto
<a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Source-Path.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Source-Path.html</a>
get the introduce about them. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5124_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Save the trace
frame info to a file </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">/sys/kernel/debug/gtpframe
supplies trace frame in tfile format (GDB can parse it) when KGTP is
stop. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that some &quot;cp&quot; cannot handle it very well, please use &quot;cat
/sys/kernel/debug/gtpframe &gt; ./gtpframe&quot; to copy it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can open
file gtpframe when you want: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target tfile ./gtpframe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8114f3dc: file
/home/teawater/kernel/linux-2.6/fs/readdir.c, line 24. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Created
tracepoint 1 for target's tracepoint 1 at 0xffffffff8114f3c0. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_readdir (file=0xffff880036e8f300, filler=0xffffffff8114f240
&lt;filldir&gt;, buf=0xffff880001e5bf38) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel/linux-2.6/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>24
     { </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5126_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Show and save the
tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
GDB command &quot;info tracepoints&quot; to show all the tracepoints.
</span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
GDB command &quot;save tracepoints filename&quot; to save the
commands that setup the tracepoints and actions into file filename.
Then you use use GDB commands &quot;source filename&quot; to setup
this tracepints again. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5128_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Delete tracepoint
</span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB command
&quot;delete id&quot; will delete tracepoint id. If &quot;delete&quot;
without argument, it will delete all the tracepoint. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5130_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use tracepoint
get register info from a point of kernel </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The following
is an example that records the value of all registers when
&quot;vfs_readdir&quot; is called. </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xc01a1ac0: file </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>/home/teawater/kernel/linux-2.6/fs/readdir.c,
line 23. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$reg </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
shell ls </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 0xc01a1ac1 in vfs_readdir (file=0xc5528d00, filler=0xc01a1900
&lt;filldir64&gt;, </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>buf=0xc0d09f90)
at /home/teawater/kernel/linux-2.6/fs/readdir.c:23 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>23
     /home/teawater/kernel/linux-2.6/fs/readdir.c: No such file or
directory. </i></span></font>
</blockquote>
<blockquote class="cjk">       <font face="DejaVu Serif, serif"><span lang="en-US"><i>in
/home/teawater/kernel/linux-2.6/fs/readdir.c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info reg </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eax
           0xc5528d00       -984445696 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ecx
           0xc0d09f90       -1060069488 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>edx
           0xc01a1900       -1072031488 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ebx
           0xfffffff7       -9 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>esp
           0xc0d09f8c       0xc0d09f8c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ebp
           0x0      0x0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>esi
           0x8061480        134616192 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>edi
           0xc5528d00       -984445696 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eip
           0xc01a1ac1       0xc01a1ac1 &lt;vfs_readdir+1&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eflags
        0x286    [ PF SF IF ] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cs
            0x60     96 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ss
            0x8061480        134616192 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ds
            0x7b     123 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>es
            0x7b     123 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>fs
            0x0      0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gs
            0x0      0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 1, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0xc01a1ac1
     23      in /home/teawater/kernel/linux-2.6/fs/readdir.c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info reg </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eax
           0xc5528d00       -984445696 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ecx
           0xc0d09f90       -1060069488 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>edx
           0xc01a1900       -1072031488 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ebx
           0xfffffff7       -9 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>esp
           0xc0d09f8c       0xc0d09f8c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ebp
           0x0      0x0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>esi
           0x8061480        134616192 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>edi
           0xc5528d00       -984445696 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eip
           0xc01a1ac1       0xc01a1ac1 &lt;vfs_readdir+1&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eflags
        0x286    [ PF SF IF ] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cs
            0x60     96 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ss
            0x8061480        134616192 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ds
            0x7b     123 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>es
            0x7b     123 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>fs
            0x0      0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gs
            0x0      0</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5919_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use tracepoint
get the value of variable from a point of kernel </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The following
is an example that records the value of &quot;jiffies_64&quot; when
the function &quot;vfs_readdir&quot; is called: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xc01ed740: file /home/teawater/kernel/linux-2.6/fs/readdir.c,
line 24. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
jiffies_64 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
file-&gt;f_path.dentry-&gt;d_iname </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
shell ls </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>arch
   drivers   include  kernel    mm               Module.symvers 
security  System.map  virt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>block
  firmware  init     lib       modules.builtin  net             sound
    t           vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>crypto
 fs        ipc      Makefile  modules.order    scripts         source
   usr         vmlinux.o </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 0xc01ed741 in vfs_readdir (file=0xf4063000, filler=0xc01ed580
&lt;filldir64&gt;, buf=0xd6dfdf90) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel/linux-2.6/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>24
     { </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p jiffies_64 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$1
= 4297248706 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p file-&gt;f_path.dentry-&gt;d_iname </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$1
= &quot;b26&quot;, '\000' &lt;repeats 28 times&gt;</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5921_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Show all the
traced data of current frame </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After use
&quot;tfind&quot; select an entry, you can use &quot;tdump&quot; to
do it. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tdump </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Data
collected at tracepoint 1, trace frame 0: </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$cr
= void </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>file-&gt;f_path.dentry-&gt;d_iname
=
&quot;gtp\000.google.chrome.g05ZYO\000\235\337\000\000\000\000\200\067k\364\200\067&quot;,
&lt;incomplete sequence \364&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>jiffies_64
= 4319751455</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5923_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get status of
tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please use GDB
command &quot;tstatus&quot;. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5925_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Set the trace
buffer into a circular buffer </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Starting-and-Stopping-Trace-Experiments.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Starting-and-Stopping-Trace-Experiments.html
</a></span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The frame
buffer is not a circular buffer by default. When the buffer is full,
the tracepoint will stop. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
command will set frame buffer to a circular buffer. When the buffer
is full, it will auto discard traceframes (oldest first) and keep
trace. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
set circular-trace-buffer on</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5927_907387813"></a><a name="Do not stop tracepoint when the GDB disconnects |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Do not stop
tracepoint when the GDB disconnects </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Starting-and-Stopping-Trace-Experiments.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Starting-and-Stopping-Trace-Experiments.html
</a></span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP will stop
tracepoint and delete the trace frame when GDB disconnects with it by
default. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
command will open the KGTP disconnect-trace. After that, when GDB
disconnects with KGTP, KGTP will not stop tracepoint. And after GDB
reconnects to KGTP, it can keep control of KGTP like nothing
happened. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
set disconnected-tracing on</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk"><a name="__RefHeading__5929_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">kprobes-optimization
and the execution speed of tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The tracepoint
is execution together with Linux kernel. So it speed will affect the
speed the system. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The KGTP
tracepoint base on Linux kernel kprobe. Because the normal kprobe
base on breakpoint instruction, so it is not very fast. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">But if arch of
kernel is X86_64 or X86_32 and kernel config didn't open &quot;Preemptible
Kernel&quot; (PREEMPT), the kprobe is speed up by
kprobes-optimization (CONFIG_OPTPROBES) that make kprobe very fast. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">To make sure
about that, you can use following command in terminal: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sysctl
-A | grep kprobe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>debug.kprobes-optimization
= 1 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">That means
that your kernel support kprobes-optimization. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that some KGTP functions will make this tracepoint use simple kprobe
even if this Kernel support kprobes-optimization. This doc will add
note when introduce these functions. Please avoid using them when you
really care about the tracepoint speed. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__5931_907387813"></a><a name="How to use trace state variables | outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use trace
state variables </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Trace-State-Variables.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Trace-State-Variables.html
</a></span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Trace state
variable is referred to as the TSV. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">TSV can be
accessed in tracepoint action and condition or direct access by GDB
command. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that just GDB 7.2.1 and later versions support use trace state
variables directly, the old version of GDB can show the value of
trace state variables through command &quot;info tvariables&quot;. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5933_907387813"></a><a name="Simple trace state variables | outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Simple trace
state variables </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Define a trace
state variable $c. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $c</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Trace state
variable $c is created with initial value 0. The following action
uses $c to count how many irqs happened in the kernel. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace handle_irq </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 3, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$c     #Save current value of $c to the trace frame buffer. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c=$c+1  #Increase the $c. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Also, you can
set a value of variable to trace state variable, but don't forget
covert variable to &quot;uint64_t&quot;. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c=(uint64_t)a</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can get
the current value of $c while the trace is running or stopped. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info tvariables </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$c
             0           31554 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$5
= 33652 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$9
= 105559</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When using
tfind, you can parse the trace frame buffer. If the value of a trace
state variable is collected, you can parse it out. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info tvariables </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$c
             0           0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$6
= 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind 100 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$7
= 100</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If need, the
tracepoint action that access the simple trace state variables will
auto lock a spin lock for trace state variables. So it can handle
race condition issue about trace state variables. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The following
example is OK even if it running a machine that have more than one
CPU. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c=$c+1</i></span></font></blockquote>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5935_907387813"></a><a name="Per_cpu trace state variables |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Per_cpu trace
state variables </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Per_cpu trace
state variables are special simple trace state variables. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When
tracepoint action access to it, it will access to this CPU special
trace state variables.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">It have 2
advantages: </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">1. The
tracepoint actions that access to per_cpu trace state variables don't
have the race conditon issue. So it don't need lock the spin lock for
trace state variables. It is faster than simple trace state variables
on multi-core machine. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">2. Write the
action that count some CPU special thing with it is easier than
simple trace state variables. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5937_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">How to define
</span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Per_cpu trace
state variables have two types: </span></font>
</p>
<p><br><br>
</p>
<h5 class="cjk"><a name="__RefHeading__5939_907387813"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Local
CPU variables </span></font>
</h5>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;per_cpu_&quot;+string
</i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">or </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;p_&quot;+string</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $p_count</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When access
this trace state variable in tracepoint actions, it will return the
variable's value of CPU that this tracepoint actions running on. </span></font>
</p>
<h5 class="cjk"><a name="__RefHeading__5941_907387813"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">CPU
id variables</span></font></h5>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;per_cpu_&quot;+string+CPU_id
</i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">or </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;p_&quot;+string+CPU_id</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"> 
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $p_count0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $p_count1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $p_count2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $p_count3 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When access
this trace state variable in tracepoint actions or GDB command line,
it will return the variable's value of CPU CPU_id. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Follow example
can auto define a CPU id variables for each CPU of this machine.
(Please note that need let GDB connect to KGTP before use these
commands.) </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
set $tmp=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
while $tmp&lt;$cpu_number </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;eval
&quot;tvariable $p_count%d&quot;,$tmp </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;set
$tmp=$tmp+1 </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5943_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Example 1</span></font></h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This example
define a tracepoint that count the times that call vfs_read of each
CPU. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tvariable
$p_count </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>while
$tmp&lt;$cpu_number </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_count%d&quot;,$tmp </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=$tmp+1 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>actions
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$p_count=$p_count+1 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
show how many vfs_read in each CPU after &quot;tstart&quot;: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $p_count0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$3
= 44802 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $p_count1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$4
= 55272 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $p_count2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$5
= 102085 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $p_count3</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__5945_907387813"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Example 2 </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This example
record stack dump of the function that close IRQ longest time of each
CPU. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>set
pagination off </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tvariable
$bt=1024 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tvariable
$p_count </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tvariable
$p_cc </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>while
$tmp&lt;$cpu_number </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_cc%d&quot;,$tmp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=$tmp+1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tvariable
$ignore_error=1 </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
arch_local_irq_disable </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$p_count=$clock </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
arch_local_irq_enable if ($p_count &amp;&amp; $p_cc &lt; $clock -
$p_count) </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$p_cc = $clock - $p_count </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$p_cc </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$p_count=0 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>enable
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>set
pagination on</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5947_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Special trace
state variables $current_task, $current_task_pid,
$current_thread_info, $cpu_id, $dump_stack, $printk_level,
$printk_format, $printk_tmp ,$clock, $hardirq_count, $softirq_count
and $irq_count </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP special
trace state variables $current_task, $current_thread_info, $cpu_id
and $clock can very easy to access to some special value. You can see
them when GDB connects to the KGTP. You can use them in tracepoint
conditions or actions. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$current_task in tracepoint condition and action will get that
returns of get_current(). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$current_task_pid in tracepoint condition and action will get that
returns of get_current()-&gt;pid. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$current_thread_info in tracepoint condition and action will get that
returns of current_thread_info(). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access $cpu_id
in tracepoint condition and action will get that returns of
smp_processor_id(). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access $clock
in tracepoint condition and action will get that returns of
local_clock() that return the timestamp in nanoseconds. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$rdtsc is only
available on X86 and X86_64 architecture. Access it in anytime will
get current value of TSC with instruction RDTSC. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$hardirq_count in tracepoint condition and action will get that
returns of hardirq_count(). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$softirq_count in tracepoint condition and action will get that
returns of softirq_count(). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access
$irq_count in tracepoint condition and action will get that returns
of irq_count(). </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">And KGTP has
other special trace state variables $dump_stack, $printk_level,
$printk_format and $printk_tmp. All of them output their values
directly, as can be seen in <a href="#Howto let tracepoint output value directly | outline">Howto
let tracepoint output value directly</a>. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The following
example counts in $c how many vfs_read calls that process 16663 does
and collects the struct thread_info of current task: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_read if (((struct task_struct *)$current_task)-&gt;pid ==
16663) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 4, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c=$c+1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
(*(struct thread_info *)$current_thread_info) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info tvariables </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Name
           Initial     Current     </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$c
             0           184         </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$current_task
  0           &lt;unknown&gt;   </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$current_thread_info
0           &lt;unknown&gt;   </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$cpu_id
        0           &lt;unknown&gt;   </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p *(struct thread_info *)$current_thread_info </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$10
= {task = 0xf0ac6580, exec_domain = 0xc07b1400, flags = 0, status =
0, cpu = 1, preempt_count = 2, addr_limit = { </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>seg
= 4294967295}, restart_block = {fn = 0xc0159fb0
&lt;do_no_restart_syscall&gt;, {{arg0 = 138300720, arg1 = 11, </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>arg2
= 1, arg3 = 78}, futex = {uaddr = 0x83e4d30, val = 11, flags = 1,
bitset = 78, time = 977063750, </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>uaddr2
= 0x0}, nanosleep = {index = 138300720, rmtp = 0xb, expires =
335007449089}, poll = { </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>ufds
= 0x83e4d30, nfds = 11, has_timeout = 1, tv_sec = 78, tv_nsec =
977063750}}}, </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>sysenter_return
= 0xb77ce424, previous_esp = 0, supervisor_stack = 0xef340044 &quot;&quot;,
uaccess_err = 0}</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Another
example shows how much sys_read() executes in each CPU. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $c0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $c1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace sys_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition $bpnum ($cpu_id == 0) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c0=$c0+1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace sys_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition $bpnum ($cpu_id == 1) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$c1=$c1+1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
info tvariables </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Name
           Initial     Current     </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$current_task
  0           &lt;unknown&gt;   </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$cpu_id
        0           &lt;unknown&gt;   </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$c0
            0           3255        </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$c1
            0           1904     </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">sys_read()
execute 3255 times in cpu0 and 1904 times in cpu1. Please note that
this example just to howto use $cpu_id. Actially, this example use
per_cpu trace state variables is better. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7575_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Special trace
state variable $self_trace </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$self_trace is
different with the special trace state variables in the previous
section. It is used to control the behavior of tracepoint. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In default,
when tracepoint is triggered, the actions will not execute if the
current_task is the a KGTP self process (GDB, netcat, getframe or
some others process that access to the interface of KGTP). </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want
tracepoint actions execute with any task, please include a command
access to the $self_trace in the actions i.e. add following command
to the actions: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$self_trace=0</i></span></font></blockquote>
<p> 
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7577_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Trace the
function return with $kret </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Sometime, set
the tracepoint to the end of function is hard because the Kernel is
compiled with optimization. At this time, you can get help from
$kret. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$kret is a
special trace state variable like $self_trace. When you set value of
it inside the action of tracepoint, this tracepoint be set with
kretprobe instead of kprobe. Then it can trace the end of this
function. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please note
that this tracepoint must set in the first address of the function in
format &quot;<b>function_name</b>&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following part
is an example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#&quot;*(function_name)&quot;
format can make certain that GDB send the first address of function
to KGTP. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace *vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$kret=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Following
part you can set commands that you want. </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7579_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use $ignore_error
and $last_errno to ignore the error of tstart </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If KGTP got
any error of tstart, this command will get fail. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">But sometime
we need ignore this error and let KGTP keep work. For example: If you
set tracepoint on the inline function spin_lock. This tracepoint will
be set to a lot of addresses that some of them cannot be set kprobe.
It will make tstart get fail. You can use &quot;$ignore_error&quot;
ignore this error. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">And the last
error number will available in &quot;$last_errno&quot;. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $ignore_error=1 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This command
will open ignore. </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $ignore_error=0 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This command
will close ignore. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7581_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use $cooked_clock
and $cooked_rdtsc the time without KGTP used </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access these
two trace state variables can get the time without KGTP used. Then we
can get more close to really time that a part of code used even if
the actions of tracepoint is very complex. They will be introduce in
Cookbook (coming soon). </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7583_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use $xtime_sec
and $xtime_nsec get the timespec </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access these
two trace state variables will return the time of day in a timespec
that use getnstimeofday. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$xtime_sec
will access to the second part of a timespec. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$xtime_nsec
will access to the nanosecond part of a timespec. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__7585_907387813"></a><a name="Howto backtrace (stack dump) |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Howto backtrace
(stack dump) </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Each time your
program performs a function call, information about the call is
generated. That information includes the location of the call in your
program, the arguments of the call, and the local variables of the
function being called. The information is saved in a block of data
called a stack frame. The stack frames are allocated in a region of
memory called the call stack. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7587_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Collect stack
with $bt and use GDB command &quot;backtrace&quot; </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Because this
way is faster (just collect the stack when trace) and parse out most
of info inside the call stack (it can show all the stack info that I
introduce). So I suggest you use this way to do the stack dump. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">First we need
add the collect the stack command to the tracepoint action. </span></font>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">The
general collect the stack command in GDB tracepoint is: In x86_32,
following command will collect 512 bytes of stack. </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">&gt;collect
*(unsigned char *)$esp@512 </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">In
x86_64, following command will collect 512 bytes of stack. </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">&gt;collect
*(unsigned char *)$rsp@512 </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">In
MIPS or ARM, following command will collect 512 bytes of stack. </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">&gt;collect
*(unsigned char *)$sp@512 </span></font></font></strike>
</p>
<p style="text-decoration: none"><strike><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">These
commands is so hard to remember, and the different arch need
different command. </span></font></font></strike>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP have an
special tracepoint trace state variable $bt. If tracepoint action
access it, KGTP will auto collect the $bt size (default value is 512)
stack. For example, this command will collect 512 bytes stack memory:
</span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want to
change size of $bt, you can use following GDB command before
&quot;tstart&quot;: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $bt=1024</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following part
is an example about howto collect stack and howto use GDB parse it: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8118c300: file
/home/teawater/kernel2/linux/fs/readdir.c, line 24. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
shell ls </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
     crypto    fs             include  kernel    mm              
Module.symvers  security  System.map  vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>arch
  drivers   hotcode.html   init     lib       modules.builtin  net   
         sound     usr         vmlinux.o </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>block
 firmware  hotcode.html~  ipc      Makefile  modules.order    scripts
        source    virt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_readdir (file=0xffff8800c5556d00, filler=0xffffffff8118c4b0
&lt;filldir&gt;, buf=0xffff880108709f40) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>24
     { </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_readdir (file=0xffff8800c5556d00, filler=0xffffffff8118c4b0
&lt;filldir&gt;, buf=0xffff880108709f40) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0xffffffff8118c689 in sys_getdents (fd=&lt;optimized out&gt;,
dirent=0x1398c58, count=32768) at
/home/teawater/kernel2/linux/fs/readdir.c:214 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#2
 &lt;signal handler called&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#3
 0x00007f00253848a5 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#4
 0x00003efd32cddfc9 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#5
 0x00002c15b7d04101 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#6
 0x000019c0c5704bf1 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#7
 0x0000000900000000 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#8
 0x000009988cc8d269 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#9
 0x000009988cc9b8d1 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#10
0x0000000000000000 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
up </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0xffffffff8118c689 in sys_getdents (fd=&lt;optimized out&gt;,
dirent=0x1398c58, count=32768) at
/home/teawater/kernel2/linux/fs/readdir.c:214 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>214
            error = vfs_readdir(file, filldir, &amp;buf); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p buf </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$1
= {current_dir = 0x1398c58, previous = 0x0, count = 32768, error = 0}
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p error </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$3
= -9 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
frame 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_readdir (file=0xffff8800c5556d00, filler=0xffffffff8118c4b0
&lt;filldir&gt;, buf=0xffff880108709f40) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>24
     {</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">From this
example, we can see some GDB commands that parse the the call stack: </span></font>
</p>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>bt</b>
	is the alias of GDB commands backtrace that print a backtrace of the
	entire stack: one line per frame for all frames in the stack. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>up n</b>
	is move n frames up the stack. For positive numbers n, this advances
	toward the outermost frame, to higher frame numbers, to frames that
	have existed longer. n defaults to one. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>down n</b>
	is move n frames down the stack. For positive numbers n, this
	advances toward the innermost frame, to lower frame numbers, to
	frames that were created more recently. n defaults to one. You may
	abbreviate down as do. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>frame
	n</b> is select frame number n. Recall that frame zero is the
	innermost (currently executing) frame, frame one is the frame that
	called the innermost one, and so on. The highest-numbered frame is
	the one for main.</span></font></p>
</ul>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can see
that when you use up, down or frame to the different calll stack
frame, you can output the value of the arguments and local variables
of different call stack frame. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">To get the
more info about howto use GDB parse the call stack, please see
<a href="#http://sourceware.org/gdb/current/onlinedocs/gdb/Stack.html">http://sourceware.org/gdb/current/onlinedocs/gdb/Stack.html
</a></span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7589_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Collect stack of
current function's caller with $_ret </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you just
want to collect stack of current function's caller, please use $_ret.
</span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that set the tracepoint that collect $_ret cannot in the first
address of function. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
list vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>360
    } </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>361
    </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>362
    EXPORT_SYMBOL(do_sync_read); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>363
    </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>364
    ssize_t vfs_read(struct file *file, char __user *buf, size_t
count, loff_t *pos) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    { </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>366
            ssize_t ret; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>367
    </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>368
            if (!(file-&gt;f_mode &amp; FMODE_READ)) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>369
                    return -EBADF; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 368 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
2 at 0xffffffff8117a244: file
/home/teawater/kernel2/linux/fs/read_write.c, line 368. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 2, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$_ret </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff880141c46000, buf=0x359bda0 &lt;Address
0x359bda0 out of bounds&gt;, count=8192, pos=0xffff88012fa49f48) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/read_write.c:368 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>368
            if (!(file-&gt;f_mode &amp; FMODE_READ)) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff880141c46000, buf=0x359bda0 &lt;Address
0x359bda0 out of bounds&gt;, count=8192, pos=0xffff88012fa49f48) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/read_write.c:368 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0xffffffff8117a3ea in sys_read (fd=&lt;optimized out&gt;,
buf=&lt;unavailable&gt;, count=&lt;unavailable&gt;) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/read_write.c:469 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Backtrace
stopped: not enough registers or memory available to unwind further </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
up </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0xffffffff8117a3ea in sys_read (fd=&lt;optimized out&gt;,
buf=&lt;unavailable&gt;, count=&lt;unavailable&gt;) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel2/linux/fs/read_write.c:469 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>469
                    ret = vfs_read(file, buf, count, &amp;pos); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p ret </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$2
= -9 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You see that
the caller of function vfs_read is sys_read. And the local variable
ret of sys_read is -9. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7591_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use $dump_stack
to output stack dump through printk </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Because this
way need parse the stack when tracing and call printk inside, so it
will be slow, unsafe, unclear and cannot access a lot of info of call
stack. So I suggest you use the prev way to do stack dump. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP has
special trace state variable $dump_stack, &quot;collect&quot; it will
let Linux Kernel output stack dump through printk. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
example lets Linux Kernel show the stack dump of vfs_readdir:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>target
remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$dump_stack </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then your
kernel will printk like: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208064]
gtp 1:Pid: 441, comm: python Not tainted 2.6.39-rc3+ #46 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208068]
Call Trace: </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208072]
 [&lt;fe653cca&gt;] gtp_get_var+0x4a/0xa0 [gtp] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208076]
 [&lt;fe653d79&gt;] gtp_collect_var+0x59/0xa0 [gtp] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208080]
 [&lt;fe655974&gt;] gtp_action_x+0x1bb4/0x1dc0 [gtp] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208084]
 [&lt;c05b6408&gt;] ? _raw_spin_unlock+0x18/0x40 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208088]
 [&lt;c023f152&gt;] ? __find_get_block_slow+0xd2/0x160 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208091]
 [&lt;c01a8c56&gt;] ? delayacct_end+0x96/0xb0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208100]
 [&lt;c023f404&gt;] ? __find_get_block+0x84/0x1d0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208103]
 [&lt;c05b6408&gt;] ? _raw_spin_unlock+0x18/0x40 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208106]
 [&lt;c02e0838&gt;] ? find_revoke_record+0xa8/0xc0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208109]
 [&lt;c02e0c45&gt;] ? jbd2_journal_cancel_revoke+0xd5/0xe0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208112]
 [&lt;c02db51f&gt;] ? __jbd2_journal_temp_unlink_buffer+0x2f/0x110 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208115]
 [&lt;fe655c4c&gt;] gtp_kp_pre_handler+0xcc/0x1c0 [gtp] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208118]
 [&lt;c05b8a88&gt;] kprobe_exceptions_notify+0x3d8/0x440 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208121]
 [&lt;c05b7d54&gt;] ? hw_breakpoint_exceptions_notify+0x14/0x180 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208124]
 [&lt;c05b95eb&gt;] ? sub_preempt_count+0x7b/0xb0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208126]
 [&lt;c0227ac5&gt;] ? vfs_readdir+0x15/0xb0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208128]
 [&lt;c0227ac4&gt;] ? vfs_readdir+0x14/0xb0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208131]
 [&lt;c05b9743&gt;] notifier_call_chain+0x43/0x60 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208134]
 [&lt;c05b9798&gt;] __atomic_notifier_call_chain+0x38/0x50 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208137]
 [&lt;c05b97cf&gt;] atomic_notifier_call_chain+0x1f/0x30 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208140]
 [&lt;c05b980d&gt;] notify_die+0x2d/0x30 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[22779.208142]
 [&lt;c05b71c5&gt;] do_int3+0x35/0xa0</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__7593_907387813"></a><a name="Howto let tracepoint output value directly | outline"></a><a name="Howto let tracepoint output value directly | outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Howto let
tracepoint output value directly </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the
previous parts, you may understand that to get a value from Linux
kernel, you need to use a tracepoint &quot;collect&quot; action to
save the value to the tracepoint frame and use the GDB command
&quot;tfind&quot; to parse the value from the frame data. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">But we want
get the value directly sometimes, so KGTP supports two ways to output
values directly. </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__7595_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">Switch
collect to output the value directly </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP has
special trace state variables $printk_level, $printk_format and
$printk_tmp to support this function. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$printk_level:
if its value is 8 (this is the default value), &quot;collect&quot;
action will save value to the tracepoint frame in the simple
behavior. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If its value
is 0-7, &quot;collect&quot; will output the value through &quot;printk&quot;
directly, and value will be the level of printk. The level is: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      KERN_EMERG      system is unusable </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      KERN_ALERT      action must be taken immediately </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      KERN_CRIT       critical conditions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>3
      KERN_ERR        error conditions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>4
      KERN_WARNING    warning conditions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>5
      KERN_NOTICE     normal but significant condition </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>6
      KERN_INFO       informational </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>7
      KERN_DEBUG      debug-level messages</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$printk_format,
collect printk will output value in the format that is set by it. The
format is: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      This is the default value. </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>If
the size of collect value is 1, 2, 4 or 8, it will be output as an
unsigned decimal. </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>If
not, it will be output as a hexadecimal string. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      Output value in signed decimal. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      Output value in unsigned decimal. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>3
      Output value in unsigned hexadecimal. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>4
      Output value as a string. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>5
      Output value as a hexadecimal string.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">$printk_tmp,
to output the value of global variable need set to it first. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
example shows a count number, pid, jiffies_64 and the file name that
call vfs_readdir: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$printk_level=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$c=$c+1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
((struct task_struct *)$current_task)-&gt;pid </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$printk_tmp=jiffies_64 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$printk_format=4 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
file-&gt;f_path.dentry-&gt;d_iname </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then your
kernel will printk like: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:$c=$c+1=41 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:((struct task_struct *)$current_task)-&gt;pid=12085 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:$printk_tmp=jiffies_64=4322021438 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:file-&gt;f_path.dentry-&gt;d_iname=b26 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:$c=$c+1=42 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:((struct task_struct *)$current_task)-&gt;pid=12085 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:$printk_tmp=jiffies_64=4322021438 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gtp
1:file-&gt;f_path.dentry-&gt;d_iname=b26 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">&quot;gtp 1&quot;
means that it was output by tracepoint 1. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__7597_907387813"></a><a name="Howto use watch tracepoint control hardware breakpoints to record memory access |outline"></a><a name="Howto use watch tracepoint control hardware breakpoints to record memory access |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Howto use watch
tracepoint control hardware breakpoints to record memory access </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Watch
tracepoint</b> can control hardware breakpoints to record the memory
access through set some special trace state variables in its action. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that watch tracepoint is just support by X86 and X86_64 now. And
dynamic watch tracepoint just can work OK in Linux 2.6.27 and newer
version because Linux 2.6.26 and older version have some IPI issues
on smp support. </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__7599_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">Trace
state variables of watch tracepoint</span></font></h3>
<table width="794" cellpadding="4" cellspacing="0" style="page-break-before: always">
	<col width="117">
	<col width="134">
	<col width="96">
	<col width="74">
	<col width="109">
	<col width="109">
	<col width="97">
	<tr valign="top">
		<td width="117" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Name</b></span></font></font></p>
		</td>
		<td width="134" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Written
			by normal tracepoint</b></span></font></font></p>
		</td>
		<td width="96" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Read
			by normal tracepoint</b></span></font></font></p>
		</td>
		<td width="74" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Written
			by static watch tracepoint</b></span></font></font></p>
		</td>
		<td width="109" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Read
			by static watch tracepoint</b></span></font></font></p>
		</td>
		<td width="109" style="border-top: 1px solid #000000; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0.1cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Written
			by dynamic watch tracepoint</b></span></font></font></p>
		</td>
		<td width="97" style="border: 1px solid #000000; padding: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US"><b>Read
			by dynamic watch tracepoint</b></span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_static</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">If
			&quot;teval $watch_static=1&quot;, then this tracepoint is static
			watch tracepoint.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">If
			&quot;teval $watch_static=1&quot;, then this tracepoint is static
			watch tracepoint.</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_set_id</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">When
			this tracepoint want to setup a dynamic watch tracepoint, set a id
			of a dynamic watch tracepoint to $watch_set_id to point out which
			dynamic watch tracepoint you wan to setup.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_set_addr</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">When
			this tracepoint want to setup a dynamic watch tracepoint, set the
			address of a dynamic watch tracepoint to $watch_set_addr to point
			out which dynamic watch tracepoint you wan to setup.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_type</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">When
			this tracepoint want to setup a dynamic watch tracepoint, set the
			watch type of this dynamic watch tracepoint to $watch_type.<br>0
			is exec. 1 is write. 2 is read or write.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the value that this tracepoint set to $watch_type</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			the type of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the type of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			the default type of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the type of this watch tracepoint when it really exec.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_size</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">When
			this tracepoint want to setup a dynamic watch tracepoint, set the
			watch size of this dynamic watch tracepoint to $watch_size.<br>The
			size should be 1, 2, 4, 8.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the value that this tracepoint set to $watch_size.</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			the size of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the size of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			the default size of this watch tracepoint.</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the size of this watch tracepoint when it really exec.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_start</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			the address to a dynamic watch tracepoint(set by $watch_set_addr
			or $watch_set_id) and let it try to start work.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the result of this start. (It will fail becasue X86 just have 4
			hardware breakpoints.)<br>Get 0 if success.  If &lt; 0 is the
			error id.</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_stop</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Set
			a address to $watch_stop will let a dynamic watch tracepoint that
			watch in this address stop.</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Get
			the result of this stop.</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_trace_num</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			tracepoint number that setup this dynamic watch tracepoint.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_trace_addr</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			tracepoint address that setup this dynamic watch tracepoint.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_addr</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			address that this watch tracepoint is watching.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			address that this watch tracepoint is watching.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_val</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			current value of the memory that this watch tracepoint is
			watching.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			current value of the memory that this watch tracepoint is
			watching.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_prev_val</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			previous value of the memory that this watch tracepoint is
			watching.</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">The
			previous value of the memory that this watch tracepoint is
			watching.</span></font></font></p>
		</td>
	</tr>
	<tr valign="top">
		<td width="117" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">$watch_count</span></font></font></p>
		</td>
		<td width="134" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="96" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="74" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="109" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: none; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">Not
			support</span></font></font></p>
		</td>
		<td width="97" style="border-top: none; border-bottom: 1px solid #000000; border-left: 1px solid #000000; border-right: 1px solid #000000; padding-top: 0cm; padding-bottom: 0.1cm; padding-left: 0.1cm; padding-right: 0.1cm">
			<p><font face="DejaVu Serif, serif"><font size="2" style="font-size: 9pt"><span lang="en-US">A
			special count for this watch tracepoint session.</span></font></font></p>
		</td>
	</tr>
</table>
<p><br><br>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7601_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Static watch
tracepoint</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
static watch tracepoint when you want watch value of a global
variable or some memory that you can get its address directly.
Following example is watch jiffies_64's write: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Static
watch tracepoint get watch address from tracepoint address. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
*&amp;jiffies_64 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>actions
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>#Set
this watch tracepoint to static </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_static=1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>#Watch
memory write </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_type=1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_size=8 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$watch_val </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$watch_prev_val </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__7603_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Dynamic watch
tracepoint </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want to
watch value of a local variable or some memory that you just get get
its address inside the function, you can use dynamic watch
tracepoint. Following example is watch write of f-&gt;f_pos and
f-&gt;f_op inside function get_empty_filp: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
*1 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_static=0 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_type=1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_size=8 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$watch_addr </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$watch_val </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$watch_prev_val </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Define a
dynamic watch tracepoint. The address &quot;1&quot; of it is not the
address of memory that it will watch. It just help tracepoint that
setup this dynamic watch tracepoint can find it.</span></font></p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>list
get_empty_filp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
133 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_set_addr=1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_size=4 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_start=&amp;(f-&gt;f_pos) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_size=8 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_start=&amp;(f-&gt;f_op) </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Define a
normal tracepoint that start to watch f-&gt;f_pos and f-&gt;f_op
inside function get_empty_filp.</span></font></p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
file_sb_list_del </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_stop=&amp;(file-&gt;f_pos) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>teval
$watch_stop=&amp;(file-&gt;f_op) </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Define a
normal tracepoint that stop the tracepoint that watch file-&gt;f_pos
and file-&gt;f_op. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__7605_907387813"></a><a name="Use while-stepping let Linux kernel do single step|outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use
while-stepping let Linux kernel do single step</span></font></h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that while-stepping is just support by X86 and X86_64 now. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Video about
howto use while-stepping <a href="#http://www.codepark.us/a/13">http://www.codepark.us/a/13</a>.
</span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__9329_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">Howto
use while-stepping </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">while-stepping
is a special tracepoint action that include some actions with it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When
tracepoints that its actions include &quot;while-stepping n&quot;
execute, it will do n times single steps and executes the actions of
while-stepping. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>trace
vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Because
single step will make system slow, so use passcount or condition to
limit the execution times of tracepoint is better. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>passcount
1 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>commands
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$step_count </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>#do
2000 times single steps. </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>while-stepping
2000 </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>#Following
part is actions of &quot;while-stepping 2000&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>#Because
step maybe execute to other functions, so does not access local
variables is better. </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>collect
$step_count </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that tracepoint will disable the interrupt of current CPU when it do
single step. Access <b>$step_count</b> in actions will get the count
of this step that begin with 1. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9331_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Read the
traceframe of while-stepping </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The data of
different step that is recorded by while-stepping actions will be
saved in different traceframe that you can use tfind (<a href="#Use tfind select the entry inside the trace frame info | outline">Use
tfind select the entry inside the trace frame info</a>) to select
them. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or you can
switch KGTP to replay mode to select all the traceframe of a
while-stepping tracepoint with GDB execution and reverse-execution
commands. For example: </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use tfind
select one the traceframe of a while-stepping tracepoint. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff8801f7bd4c00, buf=0x7fff74e4edb0 &lt;Address
0x7fff74e4edb0 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801f4b45f48)
at /build/buildd/linux-3.2.0/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    {</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
commands will swith KGTP to replay mode.</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
monitor replay </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind -1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>No
longer looking at any trace frame </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff8801f7bd4c00, buf=0x7fff74e4edb0 &lt;Address
0x7fff74e4edb0 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801f4b45f48)
at /build/buildd/linux-3.2.0/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    { </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
use execution commands. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
n </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>368
            if (!(file-&gt;f_mode &amp; FMODE_READ)) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p file-&gt;f_mode </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$5
= 3 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Set
breakpoints (Just valid in replay mode, will not affect Linux kernel
execution). </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
b 375 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Breakpoint
2 at 0xffffffff81179b75: file
/build/buildd/linux-3.2.0/fs/read_write.c, line 375. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Continuing.
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Breakpoint
2, vfs_read (file=0xffff8801f7bd4c00, buf=0x7fff74e4edb0 &lt;Address
0x7fff74e4edb0 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801f4b45f48)
at /build/buildd/linux-3.2.0/fs/read_write.c:375 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>375
            ret = rw_verify_area(READ, file, pos, count); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
s </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>rw_verify_area
(read_write=0, file=0xffff8801f7bd4c00, ppos=0xffff8801f4b45f48,
count=16) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/build/buildd/linux-3.2.0/fs/read_write.c:300 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>300
            inode = file-&gt;f_path.dentry-&gt;d_inode; </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use
reverse-execution commands. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
rs </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Breakpoint
2, vfs_read (file=0xffff8801f7bd4c00, buf=0x7fff74e4edb0 &lt;Address
0x7fff74e4edb0 out of bounds&gt;, count=16, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8801f4b45f48)
at /build/buildd/linux-3.2.0/fs/read_write.c:375 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>375
            ret = rw_verify_area(READ, file, pos, count); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
rn </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>372
            if (unlikely(!access_ok(VERIFY_WRITE, buf, count))) </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB commands
tstart, tfind or quit can auto close the replay mode. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9333_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Howto show a
variable whose value has been optimized away </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Sometimes, GDB
will output some value like:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>inode
has been optimized out of existence. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>res
has been optimized out of existence. </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">That is
because value of inode and res is optimized. Linux Kernel is built
with -O2 so you will get this trouble sometimes.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">There are 2
ways to handle it: </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__9335_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">Update
your GCC </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The VTA branch
<a href="#http://gcc.gnu.org/wiki/Var_Tracking_Assignments">http://gcc.gnu.org/wiki/Var_Tracking_Assignments</a>
was merged for GCC 4.5. This helps a lot with generating dwarf for
previously &quot;optimized out&quot; values. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9337_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get the way that
access the variable that has been out through parse ASM code </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Even if update
the GCC to the newer version, you will still meet the issue. The main
reason is the data is inside the registers but GCC doesn't put it to
debug info. Then GDB just can output this variable has been optimized
away. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">But you can
get where is the variable from ASM code and access it inside the
tracepoint actions. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following is a
example that find variable &quot;f&quot; of function get_empty_filp
and use it in tracepoint actions: </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">We want
collect the value of &quot;f&quot; but looks it has been optimized
away. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
list get_empty_filp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>137
            INIT_LIST_HEAD(&amp;f-&gt;f_u.fu_list); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>138
            atomic_long_set(&amp;f-&gt;f_count, 1); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>139
            rwlock_init(&amp;f-&gt;f_owner.lock); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>140
            spin_lock_init(&amp;f-&gt;f_lock); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>141
            eventpoll_init_file(f); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>142
            /* f-&gt;f_version: 0 */ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>143
            return f; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 143 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8119b30e: file fs/file_table.c, line 143. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
f </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>`f'
is optimized away and cannot be collected.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Now use
&quot;disassemble /m&quot; command get the ASM code and source line
that have relation with &quot;f&quot; and parse them. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
disassemble /m get_empty_filp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>...
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>125
            f = kmem_cache_zalloc(filp_cachep, GFP_KERNEL); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>126
            if (unlikely(!f)) </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b28c
&lt;+92&gt;:    test   %rax,%rax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b292
&lt;+98&gt;:    je     0xffffffff8119b362 &lt;get_empty_filp+306&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>127
                    return ERR_PTR(-ENOMEM); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b362
&lt;+306&gt;:   mov    $0xfffffffffffffff4,%rax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b369
&lt;+313&gt;:   jmp    0xffffffff8119b311 &lt;get_empty_filp+225&gt;</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Code from
&quot;+98&quot; to &quot;+132&quot; is not show in this part because
they belong to other inline function. But you can get them with GDB
command &quot;disassemble get_empty_filp&quot;. </span></font>
</p>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b287
&lt;+87&gt;:    callq  0xffffffff81181cb0 &lt;kmem_cache_alloc&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b28c
&lt;+92&gt;:    test   %rax,%rax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b28f
&lt;+95&gt;:    mov    %rax,%rbx </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b292
&lt;+98&gt;:    je     0xffffffff8119b362 &lt;get_empty_filp+306&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b298
&lt;+104&gt;:   mov    0xb4d406(%rip),%edx        #
0xffffffff81ce86a4 &lt;percpu_counter_batch&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b29e
&lt;+110&gt;:   mov    $0x1,%esi </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2a3
&lt;+115&gt;:   mov    $0xffffffff81c05340,%rdi </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>---Type
&lt;return&gt; to continue, or q &lt;return&gt; to quit--- </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2aa
&lt;+122&gt;:   callq  0xffffffff8130dd20 &lt;__percpu_counter_add&gt;</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">According to
the ASM code you can see that return value of kmem_cache_alloc is
inside $rax and its value is set to $rbx. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Looks $rbx has
the value of &quot;f&quot;. Let's check other ASM code. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>128
    </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>129
            percpu_counter_inc(&amp;nr_files); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>130
            f-&gt;f_cred = get_cred(cred); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2b4
&lt;+132&gt;:   mov    %r12,0x70(%rbx)</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Set a value to
element of f, the ASM code is set value of $r12 to a address that
base address is $rbx. It also looks like $rbx is &quot;f&quot;. </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>131
            error = security_file_alloc(f); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2b8
&lt;+136&gt;:   mov    %rbx,%rdi </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2bb
&lt;+139&gt;:   callq  0xffffffff8128ee30 &lt;security_file_alloc&gt;
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>132
            if (unlikely(error)) { </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2c0
&lt;+144&gt;:   test   %eax,%eax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2c2
&lt;+146&gt;:   jne    0xffffffff8119b36b &lt;get_empty_filp+315&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>---Type
&lt;return&gt; to continue, or q &lt;return&gt; to quit--- </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>133
                    file_free(f); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>134
                    return ERR_PTR(error); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b393
&lt;+355&gt;:   movslq -0x14(%rbp),%rax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b397
&lt;+359&gt;:   jmpq   0xffffffff8119b311 &lt;get_empty_filp+225&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>135
            } </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>136
    </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>137
            INIT_LIST_HEAD(&amp;f-&gt;f_u.fu_list); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>138
            atomic_long_set(&amp;f-&gt;f_count, 1); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>139
            rwlock_init(&amp;f-&gt;f_owner.lock); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2e4
&lt;+180&gt;:   movl   $0x100000,0x50(%rbx) </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>140
            spin_lock_init(&amp;f-&gt;f_lock); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2c8
&lt;+152&gt;:   xor    %eax,%eax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b2d1
&lt;+161&gt;:   mov    %ax,0x30(%rbx) </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>141
            eventpoll_init_file(f); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>142
            /* f-&gt;f_version: 0 */ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>143
            return f; </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff8119b30e
&lt;+222&gt;:   mov    %rbx,%rax </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">And after
check other ASM code. You can make sure that $rbx is &quot;f&quot;.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
access &quot;f&quot; through access $rbx in tracepoint actions, for
example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 143 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8119b30e: file fs/file_table.c, line 143. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#collect
f </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$rbx </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#collect
*f </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
*((struct file *)$rbx) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#collect
f-&gt;f_op </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
((struct file *)$rbx)-&gt;f_op </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9339_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to get the
function pointer point to</span></font></h2>
<h3 class="cjk"><a name="__RefHeading__9341_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">If
the debug info of the function pointer is not optimized out </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can
collect it directly and print what it point to. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>377
                    count = ret; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>378
                    if (file-&gt;f_op-&gt;read) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>379
                            ret = file-&gt;f_op-&gt;read(file, buf,
count, pos); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 379 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff81173ba5: file
/home/teawater/kernel/linux/fs/read_write.c, line 379. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
file-&gt;f_op-&gt;read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p file-&gt;f_op-&gt;read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$5
= (ssize_t (*)(struct file *, char *, size_t, loff_t *))
0xffffffff81173190 &lt;do_sync_read&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Then
you know file-&gt;f_op-&gt;read point to do_sync_read.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9343_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">If the debug info
of the function pointer is optimized out </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
tracepoint step to handle it. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Find
out which instrunction that it is called. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
disassemble /rm vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>379
                            ret = file-&gt;f_op-&gt;read(file, buf,
count, pos); </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173ba5
&lt;+181&gt;:   48 89 da        mov    %rbx,%rdx </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173ba8
&lt;+184&gt;:   4c 89 e9        mov    %r13,%rcx </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173bab
&lt;+187&gt;:   4c 89 e6        mov    %r12,%rsi </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173bae
&lt;+190&gt;:   4c 89 f7        mov    %r14,%rdi </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173bb1
&lt;+193&gt;:   ff d0   callq  *%rax </i></span></font>
</blockquote>
<blockquote class="cjk">   <font face="DejaVu Serif, serif"><span lang="en-US"><i>0xffffffff81173bb3
&lt;+195&gt;:   48 89 c3        mov    %rax,%rbx </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace *0xffffffff81173bb1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff81173bb1: file
/home/teawater/kernel/linux/fs/read_write.c, line 379. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;while-stepping
1 </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$reg </i></span></font>
</blockquote>
<blockquote class="cjk"> <font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 tty_read (file=0xffff88006ca74900, buf=0xb6b7dc &lt;Address 0xb6b7dc
out of bounds&gt;, count=8176, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>ppos=0xffff88006e197f48)
at /home/teawater/kernel/linux/drivers/tty/tty_io.c:960 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>960
    { </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Then
you know file-&gt;f_op-&gt;read point to tty_read. </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that while-stepping will make tracepoint cannot use
kprobes-optimization. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9345_907387813"></a><a name="/sys/kernel/debug/gtpframe and offline debug|outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">/sys/kernel/debug/gtpframe
and offline debug</span></font></h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">/sys/kernel/debug/gtpframe
supplies trace frame in tfile format (GDB can parse it) when KGTP is
stop.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the PC that
can run the GDB: </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Change the
&quot;target remote XXXX&quot; to </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote | perl ./getgtprsp.pl</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that,
set tracepoint and start it as usual: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_readdir </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8114f3c0: file
/home/teawater/kernel/linux-2.6/fs/readdir.c, line 24. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#If
your GDB support tracepoint &quot;printf&quot; (see &quot;Howto use
tracepoint printf&quot;), use it to show the value directly is
better. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$reg </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
stop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
quit</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find files gtpstart and gtpstop in current directory. Copy it to the
machine that you want to debug. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the
debugged machine, copy the program &quot;putgtprsp&quot; and &quot;gtp.ko&quot;
in the KGTP directory to this machine first. After insmod the gtp.ko:
</span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Start the
tracepoint: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>./putgtprsp
./gtpstart</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Stop the
tracepoint: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>./putgtprsp
./gtpstop</i></span></font></blockquote>
<p> 
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can let
Linux Kernel show the value directly, please see <a href="#Howto let tracepoint output value directly | outline">Howto
let tracepoint output value directly</a>. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want to
save the value to the trace frame and parse later, you can use file
&quot;/sys/kernel/debug/gtpframe&quot; that has the trace frame. Copy
it to the PC that has GDB. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that some &quot;cp&quot; cannot handle it very well, please use &quot;cat
/sys/kernel/debug/gtpframe &gt; ./gtpframe&quot; to copy it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the PC that
can run the GDB: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target tfile ./gtpframe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8114f3dc: file
/home/teawater/kernel/linux-2.6/fs/readdir.c, line 24. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Created
tracepoint 1 for target's tracepoint 1 at 0xffffffff8114f3c0. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_readdir (file=0xffff880036e8f300, filler=0xffffffff8114f240
&lt;filldir&gt;, buf=0xffff880001e5bf38) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>at
/home/teawater/kernel/linux-2.6/fs/readdir.c:24 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>24
     {</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that if you want connect KGTP from GDB in remote machine after use
offline debug, you need &quot;rmmod gtp&quot; and &quot;insmod
gtp.ko&quot; before call &quot;nc&quot;. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9347_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use
/sys/kernel/debug/gtpframe_pipe </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This interface
supplies same format trace frame with &quot;gtpframe&quot;. But it
can work when KGTP is running. After data is read, it will auto
deleted from trace frame like &quot;trace_pipe&quot; of ftrace. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9349_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get the frame
info with GDB </span></font>
</h3>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#connect
to the interface </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target tfile /sys/kernel/debug/gtpframe_pipe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Get
one trace frame entry </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Get
the next one </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Target
failed to find requested trace frame. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This way is
better to work with python to parse Kernel. add-ons/hotcode.py is an
example of python script. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9351_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get the frame
info with cat </span></font>
</h3>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
cat /sys/kernel/debug/gtpframe_pipe &gt; g </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then all the
trace frame will be saved in file &quot;g&quot;. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9353_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get the frame
info with getframe </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP package
include a program &quot;getframe&quot; can help you save the trace
frame to files. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following part
is the help of it: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>getframe
-h </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Get
the trace frame of KGTP and save them in current </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>directory
with tfile format. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Usage:
./getframe [option] </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>-g
n    Set the minimum free size limit to n G. </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>When
free size of current disk is smaller than n G, </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>./getframe
will exit (-q) or wait some seconds (-w). </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>The
default value of it is 2 G. </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>-q
     Quit when current disk is smaller than </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>minimum
free size limit (-g). </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>-w
n    Wait n seconds when current disk is smaller </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>than
minimum free size limit (-g). </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>-e
n    Set the entry number of each tfile to n. </i></span></font>
</blockquote>
<blockquote class="cjk">          <font face="DejaVu Serif, serif"><span lang="en-US"><i>The
default value of it is 1000. </i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>-h
     Display this information. </i></span></font>
</blockquote>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9355_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use $pipe_trace</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For the lock
safe, KGTP will ignore the task that read the
/sys/kernel/debug/gtpframe_pipe in default. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you really
need trace this task, and be sure that is safe. You can use following
command before call &quot;tstart&quot;: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $pipe_trace=1</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then KGTP will
not ignore the task that read /sys/kernel/debug/gtpframe_pipe. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9357_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use KGTP with
user applications</span></font></h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP can
access the memory and trace user applications without stop it.</span></font></p>
<h3 class="cjk"><a name="__RefHeading__5676_1661268449"></a><font face="DejaVu Serif, serif"><span lang="en-US">Let
GDB connect KGTP for user applications</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>1)</b> Open
GDB without load any user applications. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>2)</b> If
user applications is running on the current machine, use GDB command
&quot;target extended-remote /sys/kernel/debug/gtp&quot; connect to
KGTP. If user applications is running on the remote machine, use
netcat like <a href="#5.0.0.3.GDB on remote machine |outline">GDB on
remote machine</a> but replace &quot;target remote&quot; to &quot;target
extended-remote&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>3)</b> Load
user applications (it must be built with GCC option &quot;-g&quot; to
make it has debug information) with GDB command &quot;file&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>4)</b> Use
GDB command &quot;attach pid&quot; to attach the task's pid. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then let GDB
connect KGTP for user applications should be: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
gdb-release </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target extended-remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Remote
debugging using /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0x00000000
in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
file a.out </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>A
program is being debugged already. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Are
you sure you want to change the file? (y or n) y </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Reading
symbols from /home/teawater/kernel/kgtp/a.out...done. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
attach 15412 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>A
program is being debugged already.  Kill it? (y or n) y </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Attaching
to program: /home/teawater/kernel/kgtp/a.out, Remote target </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#
Some version of GDB will output internal-error, please answer &quot;n&quot;
to ignore it.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5678_1661268449"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Read memory of
user applications directly </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After GDB
attach the user applications success, you can access the memory of
this task with GDB commands &quot;p&quot; and &quot;x&quot;. You can
get help of these commands with GDB commands &quot;help p&quot; and
&quot;help x&quot;. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$19
= 4460 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p &amp;c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$21
= (int *) 0x601048 &lt;c&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
x 0x601048 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0x601048
&lt;c&gt;:   0x00001181</i></span></font></blockquote>
<p> 
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__5680_1661268449"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Trace user
applications </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP use
<b>uprobes</b> function of Linux kernel trace user applications, just
Linux kernel 3.9 and later version support this function. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The build
config of most Linux distributions's Linux kernel (3.9 and later) has
opened <b>uprobes</b>. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For the Linux
kernel that built by yourself: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Kernel
hacking  ---&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Tracers  ---&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">                <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
  Enable uprobes-based dynamic events </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If current
Linux kernel <b>uprobes</b> is opened, you can set tracepoint
according to <a href="#GDB tracepoint |outline">GDB tracepoint</a>
after GDB attach the user applications success. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0x400662: file /home/teawater/kernel/kgtp-misc/test.c, line 14. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstatus </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
is running on the target. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Collected
5 trace frames. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
buffer has 20824428 bytes of 20828160 bytes free (0% full). </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
will stop if GDB disconnects. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Not
looking at any trace frame. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 main (argc=1, argv=0x7fff5e878368, envp=0x7fff5e878378) at
/home/teawater/kernel/kgtp-misc/test.c:14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>14
                     c += 1; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 main (argc=1, argv=0x7fff5e878368, envp=0x7fff5e878378) at
/home/teawater/kernel/kgtp-misc/test.c:14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$7
= 36 </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that even if you just attch one of these tasks, user applications's
tracepoint will be triggered by all tasks of a user application. (I
think this is a very interesting feature of <b>uprobe</b>, so I
didn't limit it in KGTP tracepoint.) </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can add
$current_task_pid check to conditions of tracepoint to make
tracepoint just be triggered by one of this task. Following example
is set a tracepoint that just for task 985: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0x400662: file /home/teawater/kernel/kgtp-misc/test.c, line 14. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition $bpnum ($current_task_pid == 985) </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">And you can
&quot;collect $current_task_pid&quot; in tracepoint actions to make
sure which task triggers the tracepint. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace 14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
2 at 0x400662: file /home/teawater/kernel/kgtp-misc/test.c, line 14. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 2, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$current_task_pid </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
c </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstatus </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
is running on the target. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Collected
6 trace frames. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
buffer has 20827776 bytes of 20828160 bytes free (0% full). </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Trace
will stop if GDB disconnects. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Not
looking at any trace frame. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 main (argc=&lt;unavailable&gt;, argv=&lt;unavailable&gt;,
envp=&lt;unavailable&gt;) at
/home/teawater/kernel/kgtp-misc/test.c:14 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>14
                     c += 1; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $current_task_pid </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$2
= 9983 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 1, tracepoint 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>14
                     c += 1; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p $current_task_pid </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$3
= 9982 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
</i></span></font>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9361_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">collect stack
(for backtrace) of system from Linux kernel to user applications in
tracepoint</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$current</b>
is a special trace state variable that if the action of an tracepoint
access it, this tracepint will access the values of the registers and
the memory of current task instead of Linux kernel. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In general,
the tracepoint will get the registers value of current task from
<b>task_pt_regs</b>. Then collect <b>$current</b> in tracepoint
actions will let this tracepoint access values of current task. For
example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$current </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In addition,
for some special function that its arguments include the pointer to
the registers(for example: do_IRQ function of X86), tracepoint need
get the registers from the arguments of fuction. Then set the pointer
to $current will let this tracepoint get it. For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$current=(uint64_t)regs </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$current_task_user</b>
is a special trace state variable that it is value will be true when
current task is in user mode. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">With these two
trace state variables, you can use KGTP collect the stack(backtrace)
of current task. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
example show how we do backtrace(stack dump) from user space to Linux
kernel: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Connect
to KGTP(same with prev section) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target extended-remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Setup
an tracepoint that collect the user space stack of task 18776. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
1 at 0xffffffff8117a3d0: file
/home/teawater/kernel/linux/fs/read_write.c, line 365. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition 1 ($current_task_user &amp;&amp; $current_task_pid ==
18776) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 1, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$current </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Setup
a tracepoint that collect kernel space stack of task 18776. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace vfs_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Note:
breakpoint 1 also set at pc 0xffffffff8117a3d0. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Tracepoint
2 at 0xffffffff8117a3d0: file
/home/teawater/kernel/linux/fs/read_write.c, line 365. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
condition 2 ($current_task_user &amp;&amp; $current_task_pid ==
18776) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
actions </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Enter
actions for tracepoint 2, one per line. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>End
with a line saying just &quot;end&quot;. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstart </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Following
part is same with prev section, add a new inferior to parse info of
the user space program. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
add-inferior </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Added
inferior 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
inferior 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[Switching
to inferior 2 [&lt;null&gt;] (&lt;noexec&gt;)] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
file gdb </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Reading
symbols from /usr/local/bin/gdb...done. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
attach 18776 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#tracepoint
1 collect the user space stack. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 0, tracepoint 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 0x00007f77331d7d0f in __read_nocancel () from
/lib/x86_64-linux-gnu/libpthread.so.0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#This
is the user space backtrace of task 18776. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 0x00007f77331d7d0f in __read_nocancel () from
/lib/x86_64-linux-gnu/libpthread.so.0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0x000000000078e145 in rl_callback_read_char () at
../../src/readline/callback.c:201 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#2
 0x000000000069de79 in rl_callback_read_char_wrapper
(client_data=&lt;optimized out&gt;) at ../../src/gdb/event-top.c:169 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#3
 0x000000000069ccf8 in process_event () at
../../src/gdb/event-loop.c:401 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#4
 process_event () at ../../src/gdb/event-loop.c:351 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#5
 0x000000000069d448 in gdb_do_one_event () at
../../src/gdb/event-loop.c:465 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#6
 0x000000000069d5d5 in start_event_loop () at
../../src/gdb/event-loop.c:490 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#7
 0x0000000000697083 in captured_command_loop (data=&lt;optimized
out&gt;) at ../../src/gdb/main.c:226 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#8
 0x0000000000695d8b in catch_errors (func=0x697070
&lt;captured_command_loop&gt;, func_args=0x0, errstring=0x14df99e &quot;&quot;,
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>mask=6)
at ../../src/gdb/exceptions.c:546 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#9
 0x00000000006979e6 in captured_main (data=&lt;optimized out&gt;) at
../../src/gdb/main.c:1001 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#10
0x0000000000695d8b in catch_errors (func=0x697360 &lt;captured_main&gt;,
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>func@entry=&lt;error
reading variable: PC not available&gt;, func_args=0x7fff08afd5b0, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>func_args@entry=&lt;error
reading variable: PC not available&gt;, errstring=&lt;unavailable&gt;,
</i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>errstring@entry=&lt;error
reading variable: PC not available&gt;, mask=&lt;unavailable&gt;, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>mask@entry=&lt;error
reading variable: PC not available&gt;) at
../../src/gdb/exceptions.c:546 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#11
&lt;unavailable&gt; in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Backtrace
stopped: not enough registers or memory available to unwind further </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#The
tracepoint 2 collect the kernel space stack.  So swith to inferior 1
that load the kernel debug info. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Found
trace frame 1, tracepoint 2 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 0xffffffff8117a3d0 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
inferior 1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[Switching
to inferior 1 [Remote target] (/home/teawater/kernel/b/vmlinux)] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[Switching
to thread 1 (Remote target)] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff88021a559500, buf=0x7fff08afd31f &lt;Address
0x7fff08afd31f out of bounds&gt;, count=1, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8800c47e1f48)
at /home/teawater/kernel/linux/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>365
    { </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#This
is the backtrace of kernel stack. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
bt </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#0
 vfs_read (file=0xffff88021a559500, buf=0x7fff08afd31f &lt;Address
0x7fff08afd31f out of bounds&gt;, count=1, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>pos=0xffff8800c47e1f48)
at /home/teawater/kernel/linux/fs/read_write.c:365 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#1
 0xffffffff8117a59a in sys_read (fd=&lt;optimized out&gt;,
buf=0x7fff08afd31f &lt;Address 0x7fff08afd31f out of bounds&gt;, </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>count=1)
at /home/teawater/kernel/linux/fs/read_write.c:469 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#2
 &lt;signal handler called&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#3
 0x00007f77331d7d10 in ?? () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#4
 0x0000000000000000 in ?? ()</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9363_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use
add-ons/hotcode.py </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This script
can show the hottest code line in the Linux kernel or user space
program through parse and record the pc address in the interrupt
handler. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
<a href="#http://code.google.com/p/kgtp/wiki/hotcode">http://code.google.com/p/kgtp/wiki/hotcode</a>
see howto use it. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9365_907387813"></a><a name="How to add plugin in C |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to add plugin
in C </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP support
plugin that write in C. The plugin will be built as LKM </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__9367_907387813"></a><font face="DejaVu Serif, serif"><span lang="en-US">API
</span></font>
</h3>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#include
&quot;gtp.h&quot; </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This header
file include the API that plugin need. </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>extern
int gtp_plugin_mod_register(struct module *mod); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>extern
int gtp_plugin_mod_unregister(struct module *mod); </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">These two
functions register and unregister the plugin module. Then when KGTP
will add module usage count when it access the resource of the plugin
module. </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>extern
struct gtp_var *gtp_plugin_var_add(char *name, int64_t val, </i></span></font>
</blockquote>
<blockquote class="cjk">                                         
<font face="DejaVu Serif, serif"><span lang="en-US"><i>struct
gtp_var_hooks *hooks); </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This function
add special trace state variable to the KGTP. </span></font>
</p>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>name</b>
	is the name of special trace state variable. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>val</b>
	is initialization value of special trace state variable. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>hooks</b>
	is the function pointers. The function pointers can be set to NULL
	if this function doesn't support. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Return</b>
	the gtp_var pointer if success. Get error will return error code
	that IS_ERR and PTR_ERR can handle. </span></font>
	</p>
</ul>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>struct
gtp_var_hooks { </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>int
    (*gdb_set_val)(struct gtp_trace_s *unused, struct gtp_var *var, </i></span></font>
</blockquote>
<blockquote class="cjk">                               <font face="DejaVu Serif, serif"><span lang="en-US"><i>int64_t
val); </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>int
    (*gdb_get_val)(struct gtp_trace_s *unused, struct gtp_var *var, </i></span></font>
</blockquote>
<blockquote class="cjk">                               <font face="DejaVu Serif, serif"><span lang="en-US"><i>int64_t
*val); </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>int
    (*agent_set_val)(struct gtp_trace_s *gts, struct gtp_var *var, </i></span></font>
</blockquote>
<blockquote class="cjk">                                 <font face="DejaVu Serif, serif"><span lang="en-US"><i>int64_t
val); </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>int
    (*agent_get_val)(struct gtp_trace_s *gts, struct gtp_var *var, </i></span></font>
</blockquote>
<blockquote class="cjk">                                 <font face="DejaVu Serif, serif"><span lang="en-US"><i>int64_t
*val); </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>};
</i></span></font>
</blockquote>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gdb_set_val</b>
	will be called when GDB set the value of TSV. Please note that TSV
	just can be set by GDB command &quot;tvariable $xxx=1&quot; and the
	value just be sent to KGTP when GDB command &quot;tstart&quot;. </span></font>
	</p>
	<ul>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>unused</b>
		is unused. Just to make this pointer can share function with
		agent_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>var</b>
		is the pointer that point to the gtp_var pointer. Then function of
		plugin can use it to figure out which TSV is accessed when TSVs
		share the function. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>val</b>
		is the value that GDB set. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Return</b>
		return -1 if error. return 0 if success. </span></font>
		</p>
	</ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gdb_get_val</b>
	will be called when GDB get the value of TSV. Please note that TSV
	get is different with TSV set. It can be gotten from KGTP anytime.
	And get its value just like get the value of GDB internal value. For
	example: &quot;p $xxx&quot;. </span></font>
	</p>
	<ul>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>unused</b>
		is same with gdb_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>var</b>
		is same with gdb_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>val</b>
		is the pointer that use to return value. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Return</b>
		is same with gdb_set_val. </span></font>
		</p>
	</ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>agent_set_val</b>
	will be called when tracepoint action(<a href="#8.0.0.4.teval expr1, expr2, ... |outline">teval
	expr1, expr2, ...</a>) set the value of TSV. </span></font>
	</p>
	<ul>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gts</b>
		is pointer to the tracepoint session struct. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>var</b>
		is same with gdb_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>val</b>
		is the value the action set. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Return</b>
		is same with gdb_set_val. </span></font>
		</p>
	</ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>agent_get_val</b>
	will be called when tracepoint action(<a href="#collect expr1, expr2, ... |outline">collect
	expr1, expr2, ...</a> or <a href="#teval expr1, expr2, ... |outline">teval
	expr1, expr2, ...</a>) get the value of TSV. </span></font>
	</p>
	<ul>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gts</b>
		is same with agent_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>var</b>
		is same with gdb_set_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>val</b>
		is same with gdb_get_val. </span></font>
		</p>
		<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Return</b>
		is same with gdb_set_val. </span></font>
		</p>
	</ul>
</ul>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>extern
int gtp_plugin_var_del(struct gtp_var *var); </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">When rmmod the
plugin module, use this function remove the TSV that
gtp_plugin_var_add add. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9369_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Example </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">plugin_example.c
that in the KGTP directory is the example for KGTP plugin. You can
use &quot;make P=1&quot; build it. It add 4 TSV to KGTP. </span></font>
</p>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$test1</b>
	support nothing. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$test2</b>
	support be get and set by GDB or tracepoint action. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$test3</b>
	just support tracepoint action set. When set a value to it, it will
	look up a kernel symbol of this value and print it. For example
	&quot;teval $test3=(int64_t)$rip&quot;. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>$test4</b>
	just support tracepoint action set. When set a value to it, it will
	look up a kernel symbol of current tracepoint address and print it. </span></font>
	</p>
</ul>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9371_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use</span></font></h3>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US">insmod
	KGTP module according to <a href="#Insmod the KGTP module |outline">Insmod
	the KGTP module</a>. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US">insmod
	plugin_example.ko </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US">Use GDB
	connect to KGTP and use it. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US">Disconnect
	GDB. If option in <a href="#Do not stop tracepoint when the GDB disconnects |outline">Do
	not stop tracepoint when the GDB disconnects</a> set to on, set it
	to off. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US">rmmod
	plugin_example.ko </span></font>
	</p>
</ul>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that KGTP support add more than one plugin. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__9373_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use
performance counters </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Performance
counters are special hardware registers available on most modern
CPUs. These registers count the number of certain types of hw events:
such as instructions executed, cachemisses suffered, or branches
mis-predicted - without slowing down the kernel or applications.
These registers can also trigger interrupts when a threshold number
of events have passed - and can thus be used to profile the code that
runs on that CPU. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The Linux
Performance Counter subsystem called perf event can get the value of
performance counter. You can access it through KGTP perf event trace
state variables. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
read the file tools/perf/design.txt in Linux Kernel to get more info
about perf event. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9375_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Define a perf
event trace state variable </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Access an
performance counter need define following trace state variable: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;pe_cpu_&quot;+tv_name
      Define the the CPU id of the performance counter. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;pe_type_&quot;+tv_name
     Define the the type of the performance counter. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;pe_config_&quot;+tv_name
   Define the the config of the performance counter. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;pe_en_&quot;+tv_name
       This the switch to enable or disable the performance counter. </i></span></font>
</blockquote>
<blockquote class="cjk">                        <font face="DejaVu Serif, serif"><span lang="en-US"><i>The
performance counter is disable in default. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;pe_val_&quot;+tv_name
      Access this variable can get the value of the performance
counter.</i></span></font></blockquote>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9377_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Define a per_cpu
perf event trace state variable </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Define a
per_cpu perf event trace state variable is same with define <a href="#Per_cpu trace state variables |outline">Per_cpu
trace state variables</a>. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&quot;p_pe_&quot;+perf_event
type+string+CPU_id </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that if you define a per_cpu perf event trace state variable, you
will not need define the cpu id(&quot;pe_cpu&quot;) because KGTP
already get it. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9379_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">The perf event
type and config </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The type of
perf event can be: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      PERF_TYPE_HARDWARE </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      PERF_TYPE_SOFTWARE </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      PERF_TYPE_TRACEPOINT </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>3
      PERF_TYPE_HW_CACHE </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>4
      PERF_TYPE_RAW </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>5
      PERF_TYPE_BREAKPOINT </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If the type is
0(PERF_TYPE_HARDWARE), the config can be: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      PERF_COUNT_HW_CPU_CYCLES </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      PERF_COUNT_HW_INSTRUCTIONS </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      PERF_COUNT_HW_CACHE_REFERENCES </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>3
      PERF_COUNT_HW_CACHE_MISSES </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>4
      PERF_COUNT_HW_BRANCH_INSTRUCTIONS </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>5
      PERF_COUNT_HW_BRANCH_MISSES </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>6
      PERF_COUNT_HW_BUS_CYCLES </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>7
      PERF_COUNT_HW_STALLED_CYCLES_FRONTEND </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>8
      PERF_COUNT_HW_STALLED_CYCLES_BACKEND </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If the type is
3(PERF_TYPE_HW_CACHE), the config need to divide to 3 parts: First
one is cache id, it need be &lt;&lt; 0 before set to config: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      PERF_COUNT_HW_CACHE_L1D </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      PERF_COUNT_HW_CACHE_L1I </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      PERF_COUNT_HW_CACHE_LL </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>3
      PERF_COUNT_HW_CACHE_DTLB </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>4
      PERF_COUNT_HW_CACHE_ITLB </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>5
      PERF_COUNT_HW_CACHE_BPU</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Second one is
cache op id, it need be &lt;&lt; 8 before set to config: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      PERF_COUNT_HW_CACHE_OP_READ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      PERF_COUNT_HW_CACHE_OP_WRITE </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>2
      PERF_COUNT_HW_CACHE_OP_PREFETCH</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Last one is
cache op result id, it need be &lt;&lt; 16 before set to config: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0
      PERF_COUNT_HW_CACHE_RESULT_ACCESS </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>1
      PERF_COUNT_HW_CACHE_RESULT_MISS</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you want
get the perf count of PERF_COUNT_HW_CACHE_L1I(1),
PERF_COUNT_HW_CACHE_OP_WRITE(1) and
PERF_COUNT_HW_CACHE_RESULT_MISS(1), you can use: </span></font>
</p>
<p><br><br>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tvariable $pe_config_cache=1 | (1 &lt;&lt; 8) | (1 &lt;&lt; 16) </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">tools/perf/design.txt
in Linux Kernel have more info about type and config of perf event. </span></font>
</p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9381_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Enable and
disable all the perf event in a CPU with $p_pe_en</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">I think the
best way that count a part of code with performance counters is
enable all the count in the begin of the code and disable all of them
in the end. You can do it with &quot;pe_en&quot;. But if you have a
lot of perf event trace state variables. That will make the
tracepoint action very big. $p_pe_en is for this issue. You can
enable all the perf event trace state variables in current CPU with
following action: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_en=1 </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Disable them
with set $p_pe_en to 0. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_en=0</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__9383_907387813"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">GDB scripts to
help with set and get the perf event trace state variables </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following is a
GDB script define two commands dpe and spe to help define and show
the perf event trace state variables. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can put it
to the ~/.gdbinit or your tracepoint script. Then you can use this
two commands in GDB directly. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>define
dpe </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc &lt; 2) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>printf
&quot;Usage: dpe pe_type pe_config [enable]\n&quot; </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc &gt;= 2) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_val_%d%d_c&quot;,$arg0, $arg1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_en_%d%d_c&quot;,$arg0, $arg1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=0 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>while
$tmp&lt;$cpu_number </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_type_%d%d_c%d=%d&quot;,$arg0, $arg1, $tmp,
$arg0 </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_config_%d%d_c%d=%d&quot;,$arg0, $arg1, $tmp,
$arg1 </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_val_%d%d_c%d=0&quot;,$arg0, $arg1, $tmp </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc &gt;= 3) </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;tvariable $p_pe_en_%d%d_c%d=%d&quot;,$arg0, $arg1, $tmp, $arg2 </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=$tmp+1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>document
dpe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Usage:
dpe pe_type pe_config [enable] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>define
spe </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc != 2 &amp;&amp; $argc != 3) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>printf
&quot;Usage: spe pe_type pe_config [cpu_id]\n&quot; </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc == 2) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=0 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>while
$tmp&lt;$cpu_number </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;printf \&quot;$p_pe_val_%%d%%d_c%%d=%%ld\\n\&quot;,$arg0,
$arg1, $tmp, $p_pe_val_%d%d_c%d&quot;, $arg0, $arg1, $tmp </i></span></font>
</blockquote>
<blockquote class="cjk">      <font face="DejaVu Serif, serif"><span lang="en-US"><i>set
$tmp=$tmp+1 </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>if
($argc == 3) </i></span></font>
</blockquote>
<blockquote class="cjk">    <font face="DejaVu Serif, serif"><span lang="en-US"><i>eval
&quot;printf \&quot;$p_pe_val_%%d%%d_c%%d=%%ld\\n\&quot;,$arg0,
$arg1, $tmp, $p_pe_val_%d%d_c%d&quot;, $arg0, $arg1, $arg2 </i></span></font>
</blockquote>
<blockquote class="cjk">  <font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>end
</i></span></font>
</blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>document
spe </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Usage:
spe pe_type pe_config [cpu_id] </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>end</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following is
an example to use it get the performance counters of function
tcp_v4_rcv: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Connect
to KGTP </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Define
3 pe tvs for PERF_COUNT_HW_CPU_CYCLES, PERF_COUNT_HW_CACHE_MISSES and
PERF_COUNT_HW_BRANCH_MISSES. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
dpe 0 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
dpe 0 3 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
dpe 0 5 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#enable
the performance counters of this CPU in the begin of this function. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace tcp_v4_rcv </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
action </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_en=1 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#$kret
make this hanler the end of function tcp_v4_rcv. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
trace *(tcp_v4_rcv) </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
action </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$kret=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#disable
all performance counters of this CPU </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_en=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Access
the per cpu perf event tv will access to the current cpu pe tv. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$p_pe_val_00_0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$p_pe_val_03_0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;collect
$p_pe_val_05_0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Set
all the pe tv to 0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_val_00_0=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_val_03_0=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;teval
$p_pe_val_05_0=0 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>&gt;end
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>tstart
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Wait
some time that current pc receive some tcp package. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tstop </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
tfind </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
spe 0 0 $cpu_id </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$p_pe_val_00_2=12676
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
spe 0 3 $cpu_id </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$p_pe_val_03_2=7
</i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
spe 0 5 $cpu_id </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$p_pe_val_05_2=97</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h1 class="cjk" align="left" style="font-variant: normal; page-break-before: always"><a name="__RefHeading__11428_1305468286"></a><a name="5.Appendix A Preparatory work before use KGTP|outline"></a>
<font color="#000000"><font face="arial, sans-serif"><font size="7" style="font-size: 36pt"><span lang="en-US">Appendix
A Preparatory work before use KGTP</span></font></font></font></h1>
<h2 class="cjk"><a name="__RefHeading__625_1585187435"></a><font face="DejaVu Serif, serif"><span lang="en-US">Linux
kernel</span></font></h2>
<h3 class="cjk" style="font-variant: normal"><a name="__RefHeading__627_1585187435"></a><a name="If your system use the Linux kernel that is built by yourself|outline"></a>
<font color="#000000"><font face="DejaVu Serif, serif"><span lang="en-US">If
your system use the Linux kernel that is built by yourself</span></font></font></h3>
<p><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt"><span lang="en-US">To
use KGTP, <span style="font-variant: normal"><font color="#000000"><font face="arial, sans-serif"><span style="font-style: normal"><span style="font-weight: normal">your</span></span></font></font></span>
Linux kernel need open following options:</span></font></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>General
setup  ---&gt;</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Kprobes</i></span></font></blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Enable loadable module support  ---&gt;</i></span></font></blockquote>
<blockquote class="cjk"><br>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Kernel
hacking  ---&gt;</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Debug Filesystem</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Compile the kernel with debug info</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please rebuild
your Linux kernel if you change any options of the config.</span></font></p>
<p><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__629_1585187435"></a><a name="If use with Linux kernel of Android|outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">If use with Linux
kernel of Android</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The default
Linux kernel config of Android should not support KGTP. To use KGTP,
Linux kernel of Android need open following options:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Enable loadable module support  ---&gt;</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>General
setup  ---&gt; </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Prompt for development and/or incomplete code/drivers</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Kprobes</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Kernel
hacking  ---&gt;</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Debug Filesystem</i></span></font></blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>[*]
Compile the kernel with debug info</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please rebuild
your Linux kernel if you change any options of the Linux kernel
config.</span></font></p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__631_1585187435"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">If your system
use the Linux kernel from distribution</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You need
install some Linux kernel package.</span></font></p>
<h4 class="cjk"><a name="__RefHeading__882_1585187435"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Ubuntu</span></font></h4>
<h5 class="cjk"><a name="__RefHeading__884_1585187435"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">The
standard method of install the Linux kernel debug image</span></font></h5>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>1) Add
debug source to the sources list of Ubuntu.</b></span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Create an
/etc/apt/sources.list.d/ddebs.list by running the following line at a
terminal:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>echo
&quot;deb http://ddebs.ubuntu.com $(lsb_release -cs) main restricted
universe multiverse&quot; | \</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
tee -a /etc/apt/sources.list.d/ddebs.list</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Stable
releases (not alphas and betas) require three more lines adding to
the same file, which is done by the following terminal command:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>echo
&quot;deb http://ddebs.ubuntu.com $(lsb_release -cs)-updates main
restricted universe multiverse</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>deb
http://ddebs.ubuntu.com $(lsb_release -cs)-security main restricted
universe multiverse</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>deb
http://ddebs.ubuntu.com $(lsb_release -cs)-proposed main restricted
universe multiverse&quot; | \</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
tee -a /etc/apt/sources.list.d/ddebs.list</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Import the
debug symbol archive signing key:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-key adv --keyserver keyserver.ubuntu.com --recv-keys 428D7C01</i></span></font></blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then run:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-get update</i></span></font></blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>2) Get
Linux kernel debug image</b></span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-get install linux-image-$(uname -r)-dbgsym</i></span></font></blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find Linux kernel debug image in &quot;/usr/lib/debug/boot/vmlinux-$(uname
-r)&quot;.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that this step <b>Get Linux kernel debug image</b> need do again when
Linux kernel update.</span></font></p>
<p><br><br>
</p>
<h5 class="cjk"><a name="__RefHeading__886_1585187435"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">The
second method of install the Linux kernel debug image</span></font></h5>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you got
some trouble with the standard method, please use following commands
to install the Linux kernel debug image.</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>wget
http://ddebs.ubuntu.com/pool/main/l/linux/linux-image-$(uname
-r)-dbgsym_$(dpkg -s linux-image-$(uname -r) | grep ^Version: | sed
's/Version: //')_$(uname -i | sed 's/x86_64/amd64/').ddeb</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
dpkg -i linux-image-$(uname -r)-dbgsym_$(dpkg -s linux-image-$(uname
-r) | grep ^Version: | sed 's/Version: //')_$(uname -i | sed
's/x86_64/amd64/').ddeb</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that this method need do again when Linux kernel update.</span></font></p>
<h5 class="cjk"><a name="__RefHeading__888_1585187435"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Install
the Linux kernel headers</span></font></h5>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-get install linux-headers-generic</i></span></font></blockquote>
<p><br>
</p>
<h5 class="cjk"><a name="__RefHeading__890_1585187435"></a><a name="5.0.0.1.4.Install the Linux kernel source|outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Install the
Linux kernel source</span></font></h5>
<h6 class="cjk"><a name="__RefHeading__10573_680043226"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">New
way</span></font></h6>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Install
package that we need:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-get install dpkg-dev</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Get the Linux
kernel source:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>apt-get
source linux-image-$(uname -r)</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find Linux kernel directory in current directory. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Move this
directory to &quot;/build/buildd/&quot;.</span></font></p>
<h6 class="cjk"><a name="__RefHeading__10575_680043226"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Old
way</span></font></h6>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Install the
source package:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
apt-get install linux-source</i></span></font></blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Uncompress the
source package:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
mkdir -p /build/buildd/</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
tar vxjf /usr/src/linux-source-$(uname -r | sed 's/-.*//').tar.bz2 -C
/build/buildd/</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
rm -rf /build/buildd/linux-$(uname -r | sed 's/-.*//')</i></span></font></blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
mv /build/buildd/linux-source-$(uname -r | sed 's/-.*//')
/build/buildd/linux-$(uname -r | sed 's/-.*//')</i></span></font></blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that this step <a href="#5.0.0.1.4.Install the Linux kernel source|outline"><b>Install
the Linux kernel source</b></a> need do again when Linux kernel
update.</span></font></p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4078_695897485"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Fedora</span></font></h4>
<h5 class="cjk"><a name="__RefHeading__4080_695897485"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Install
the Linux kernel debug image</span></font></h5>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use following
command: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
debuginfo-install kernel </i></span></font>
</blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
yum --enablerepo=fedora-debuginfo install kernel-debuginfo </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find Linux kernel debug image in &quot;/usr/lib/debug/lib/modules/$(uname
-r)/vmlinux&quot;. </span></font>
</p>
<h5 class="cjk"><a name="__RefHeading__4082_695897485"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Install
the Linux kernel devel package </span></font>
</h5>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
yum install kernel-devel-$(uname -r) </i></span></font>
</blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that after update the Linux kernel package, you may need to call this
command.</span></font></p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4084_695897485"></a><a name="Make sure current Linux kernel debug image is right |outline"></a><a name="Make sure current Linux kernel debug image is right |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Make sure current
Linux kernel debug image is right </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">GDB open the
right Linux kernel debug image is an very important because GDB will
get the debug info and address info from it. So before you use KGTP,
please do the check to make sure about it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">There are 2
ways to do the check, what I suggest is do both of them to make sure
Linux kernel debug image is right. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that if you determine you use the right Linux kernel debug image, but
cannot pass these ways. Please see <a href="#Handle the issue that Linux kernel debug image's address info is not same with Linux kernel when it running |outline">Handle
the issue that Linux kernel debug image's address info is not same
with Linux kernel when it running</a>.</span></font></p>
<h4 class="cjk"><a name="__RefHeading__4086_695897485"></a><a name="4.0.0.3.Where is the current Linux kernel debug image |outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Where is the
current Linux kernel debug image </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In UBUNTU, you
can find it in &quot;/usr/lib/debug/boot/vmlinux-$(uname -r)&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In Fedora, you
can find it in &quot;/usr/lib/debug/lib/modules/$(uname -r)/vmlinux&quot;.
</span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you build
Linux kernel with yourself, file &quot;vmlinux&quot; in the Linux
kernel build directory is the debug image.</span></font></p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4088_695897485"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Use
/proc/kallsyms </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the system
that its Linux kernel is what you want to trace, use following
command to get the address of sys_read and sys_write: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
cat /proc/kallsyms | grep sys_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ffffffff8117a520
T sys_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
cat /proc/kallsyms | grep sys_write </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ffffffff8117a5b0
T sys_write </i></span></font>
</blockquote>
<p><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then we can
get that the address of sys_read is 0xffffffff8117a520 and the
address of sys_write is 0xffffffff8117a5b0. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that use
GDB get address of sys_read and sys_write from Linux kernel debug
image: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gdb
./vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p sys_read </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$1
= {long int (unsigned int, char *, size_t)} 0xffffffff8117a520
&lt;sys_read&gt; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p sys_write </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$2
= {long int (unsigned int, const char *, size_t)} 0xffffffff8117a5b0
&lt;sys_write&gt; </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The address of
sys_read and sys_write is same, so the Linux kernel debug image is
right. </span></font>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4090_695897485"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Use
linux_banner </span></font>
</h4>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i><kbd>sudo
gdb ./vmlinux </kbd></i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i><kbd>(gdb)
p linux_banner </kbd></i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i><kbd>$1
= &quot;Linux version 3.4.0-rc4+ (teawater@teawater-Precision-M4600)
(gcc version 4.6.3 (GCC) ) #3 SMP Tue Apr 24 13:29:05 CST 2012\n&quot;
</kbd></i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This
linux_banner is the kernel info inside the Linux kernel debug image. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that,
connect to KGTP following the way in <a href="#Make GDB connect to gtp|outline">Make
GDB connect to gtp</a> connect to KGTP and print linux_banner again. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Remote
debugging using /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0x0000000000000000
in irq_stack_union () </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
p linux_banner </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>$2
= &quot;Linux version 3.4.0-rc4+ (teawater@teawater-Precision-M4600)
(gcc version 4.6.3 (GCC) ) #3 SMP Tue Apr 24 13:29:05 CST 2012\n&quot;
</i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This
linux_banner is the kernel info that Linux kernel that KGTP is
tracing. If it is same with the prev kernel info, the Linux kernel
debug image is right. </span></font>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4092_695897485"></a><a name="Handle the issue that Linux kernel debug image's address info is not same with Linux kernel when it running |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Handle the issue
that Linux kernel debug image's address info is not same with Linux
kernel when it running </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In X86_32, you
will found that the Linux kernel debug image's address info is not
same with Linux kernel when it running through the ways in <a href="#Make sure current Linux kernel debug image is right |outline">Make
sure current Linux kernel debug image is right</a>. And you determine
the Linux kernel debug image is right. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This issue is
because: </span></font>
</p>
<blockquote class="cjk"><font color="#0000ff"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Processor
type and features  ---&gt; </i></span></font></font>
</blockquote>
<blockquote class="cjk"><font color="#0000ff">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>(0x1000000)
Physical address where the kernel is loaded </i></span></font></font>
</blockquote>
<blockquote class="cjk"><font color="#0000ff">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>(0x100000)
Alignment value to which kernel should be aligned</i></span></font></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The values of
these two options are different. Please <b>note</b> that the
&quot;Physical address where the kernel is loaded&quot; is not showed
in config sometimes. You can get its value through search
&quot;PHYSICAL_START&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can handle
this issue through change &quot;Alignment value to which kernel
should be aligned&quot; same with &quot;Physical address where the
kernel is loaded&quot;. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This issue
doesn't affect X86_64. </span></font>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4094_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get KGTP</span></font></h2>
<h3 class="cjk"><a name="__RefHeading__4096_695897485"></a><font face="DejaVu Serif, serif"><span lang="en-US">Get
KGTP through http </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
<a href="https://github.com/teawater/kgtp/archive/master.zip">https://github.com/teawater/kgtp/archive/master.zip</a>
get the upstream version of KGTP. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please goto
<a href="https://github.com/teawater/kgtp/archive/release.zip">https://github.com/teawater/kgtp/archive/release.zip</a>
get the last release of KGTP.</span></font></p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4098_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Get KGTP through
git</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
command will get the upstream version of KGTP:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>git
clone https://github.com/teawater/kgtp.git</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
command will get the last release version of KGTP:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>git
clone https://github.com/teawater/kgtp.git -b release</i></span></font></blockquote>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__10684_1267614711"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Mirrors</span></font></h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="https://code.csdn.net/teawater/kgtp">https://code.csdn.net/teawater/kgtp</a></span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="https://www.gitshell.com/teawater/kgtp/">https://www.gitshell.com/teawater/kgtp/</a></span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><a href="https://git.oschina.net/teawater/kgtp">https://git.oschina.net/teawater/kgtp</a></span></font></p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4748_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Config KGTP </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following part
is the default config of KGTP inside the Makefile. With this config,
KGTP will build together with current kernel that running on this
machine. </span></font>
</p>
<blockquote class="cjk"><font color="#0000ff"><font face="DejaVu Serif, serif"><span lang="en-US"><i>KERNELDIR
:= /lib/modules/`uname -r`/build </i></span></font></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>CROSS_COMPILE
:= </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KERELDIR is
set to the directory which holds the kernel you want to build for. By
default, it is set to the kernel that you are running. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please note
that this directory should be Linux kernel build directory or
linux-headers directory but not the
Linux kernel source directory. And the Linux kernel build directory
should be used after build successful. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">CROSS_COMPILE
is set to the prefix name of compiler that you want to build KGTP.
Empty to compile with your default compiler. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">ARCH is the
architecture. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or you can
choose which kernel you want build with and which compiler you want
use by change Makefile. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>KERNELDIR
:= /home/teawater/kernel/bamd64 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>CROSS_COMPILE
:=x86_64-glibc_std- </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>ARCH
:= x86_64 </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KERNELDIR is
set to /home/teawater/kernel/bamd64. Compiler will use
x86_64-glibc_std-gcc. </span></font>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4750_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Compile KGTP </span></font>
</h2>
<h3 class="cjk"><a name="__RefHeading__4752_695897485"></a><font face="DejaVu Serif, serif"><span lang="en-US">Normal
compile </span></font>
</h3>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cd
kgtp/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
</i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In some build
environment (for example Android) will get some error with user space
program getmod or getframe. Please ignore this error and use the
gtp.ko in this directory. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you get
error message &quot;/usr/bin/ld: cannot find -lc&quot; in Fedora,
please use following command handle it. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
yum install glibc-static</i></span></font></blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4754_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Compile KGTP with
some special config </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Most of time,
KGTP can auto select right options to build with Various versions of
Linux kernel. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">But if you
want config special options with yourself, you can read following
part: </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">With this
option, KGTP will not auto select any build options. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
AUTO=0 </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">With this
option, KGTP will use simple frame instead of KGTP ring buffer. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The simple
frame doesn't support gtpframe_pipe. It just for debug KGTP. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
AUTO=0 FRAME_SIMPLE=1</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">With this
option, $clock will return rdtsc value instead of local_clock. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
AUTO=0 CLOCK_CYCLE=1</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">With this
option, KGTP will use procfs instead of debugfs.</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
AUTO=0 USE_PROC=1 </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The options
can use together, for example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>make
AUTO=0 FRAME_SIMPLE=1 CLOCK_CYCLE=1 </i></span></font>
</blockquote>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4756_695897485"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Install and
uninstall KGTP </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">KGTP don't
need to be install because it can insmod directly inside its
directory (See <a href="#Insmod the KGTP module |outline">Insmod the
KGTP module</a>). But if you need, you can install it to your system.
</span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Install: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cd
kgtp/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
make install</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Uninstall: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cd
kgtp/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
make uninstall </i></span></font>
</blockquote>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4427_1176671169"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use KGTP with
DKMS</span></font></h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can use
KGTP with DKMS if you want it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Following
commands will copy the files of KGTP to the directory that DKMS need.
</span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cd
kgtp/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
make dkms</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"> 
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
use DKMS commands to control KGTP. Please goto
<a href="#http://linux.dell.com/dkms/manpage.html">http://linux.dell.com/dkms/manpage.html</a>
to see how to use DKMS. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4429_1176671169"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Use KGTP patch
for Linux kernel </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Most of time,
you don't need KGTP patch because KGTP can build as a LKM and very
easy to use. But to help some people include KGTP to them special
Linux Kernel tree, KGTP supply patches for Linux kernel. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">In the KGTP
directory: </span></font>
</p>
<ul>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_3.7_to_upstream.patch</b>
	is the patch for Linux kernel from 3.7 to upstream. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_3.0_to_3.6.patch
	is the patch</b> for Linux kernel from 3.0 to 3.6. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_2.6.39.patch
	is the patch</b> for Linux kernel 2.6.39. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_2.6.33_to_2.6.38.patch</b>
	is the patch for Linux kernel from 2.6.33 to 2.6.38. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_2.6.20_to_2.6.32.patch</b>
	is the patch for Linux kernel from 2.6.20 to 2.6.32. </span></font>
	</p>
	<li><p><font face="DejaVu Serif, serif"><span lang="en-US"><b>gtp_older_to_2.6.19.patch</b>
	is the patch for Linux kernel 2.6.19 and older version. </span></font>
	</p>
</ul>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4431_1176671169"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Install GDB for
KGTP </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">The GDB that
older than 7.6 have some bugs of tracepoint. And some functions of
GDB are not very well. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">So if your GDB
is older than 7.6 please go to <a href="#https://code.google.com/p/gdbt/">https://code.google.com/p/gdbt/</a>
to get howto install GDB for KGTP. It supplies sources of UBUBTU,
CentOS, Fedora, Mandriva, RHEL, SLE, openSUSE. Also have static
binary for others. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you have
issue about GDB please get help according to <a href="#3.Get help or report issues about KGTP|outline">Get
help or report issues about KGTP</a>.</span></font></p>
<p><br><br>
</p>
<h1 class="cjk" style="page-break-before: always"><a name="__RefHeading__4433_1176671169"></a><a name="6.Appendix B How to let GDB connect to KGTP|outline"></a><a name="6.Appendix B How to let GDB connect to KGTP|outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Appendix B
How to let GDB connect to KGTP</span></font></h1>
<p><font face="DejaVu Serif, serif"><span lang="en-US">To use KGTP
function need let GDB connect to KGTP first. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk"><a name="__RefHeading__4435_1176671169"></a><font face="DejaVu Serif, serif"><span lang="en-US">Normal
Linux </span></font>
</h2>
<h3 class="cjk"><a name="__RefHeading__4437_1176671169"></a><a name="Insmod the KGTP module |outline"></a><a name="Insmod the KGTP module |outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Insmod the KGTP
module </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you have
installed KGTP in your system, you can:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
modprobe gtp</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or you can use
the kgtp module in the directory. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>cd
kgtp/ </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
insmod gtp.ko</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4439_1176671169"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Handle the issue
that cannot find &quot;/sys/kernel/debug/gtp&quot; </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you got
this issue, please make sure &quot;Debug Filesystem&quot; is opened
in your kernel config first.  Please goto <a href="#If your system use the Linux kernel that is built by yourself|outline">If
your system use the Linux kernel that is built by yourself</a> see
how to open it.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If it is
opened, please use following command mount sysfs. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
mount -t sysfs none /sys/ </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Maybe you will
got some error for examle &quot;sysfs is already mounted on /sys&quot;.
Please ignore it.</span></font></p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">please use
following command mount debugfs. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>mount
-t debugfs none /sys/kernel/debug/</i></span></font></blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find &quot;/sys/kernel/debug/gtp&quot;.</span></font></p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4283_1369842245"></a><a name="Make GDB connect to gtp|outline"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Make GDB connect
to gtp</span></font></h3>
<h4 class="cjk"><a name="__RefHeading__10764_1675807557"></a><font face="DejaVu Sans, sans-serif"><span lang="en-US">Load
Linux kernel debug image to GDB</span></font></h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">You can open
GDB with following command to load image:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gdb
kernel_debug_image_file</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Or after you
open GDB, use following GDB command to load image:</span></font></p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>file
kernel_debug_image_file</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">According to
“<a href="#4.0.0.3.Where is the current Linux kernel debug image |outline">Where
is the current Linux kernel debug image</a>”, You can find Linux
kernel debug image (kernel_debug_image_file).</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that let GDB open a right vmlinux file is very important for KGTP.
Please goto “<a href="#Make sure current Linux kernel debug image is right |outline">Make
sure current Linux kernel debug image is right</a>” get how to do
it. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4816_1369842245"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">GDB on the
current machine</span></font></h4>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
gdb ./vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Remote
debugging using /sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>0x0000000000000000
in ?? () </i></span></font>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that,
you can begin to use GDB command trace and debug the Linux Kernel. </span></font>
</p>
<p><br><br>
</p>
<h4 class="cjk" style="page-break-before: always"><a name="__RefHeading__4818_1369842245"></a><a name="5.0.0.3.GDB on remote machine |outline"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">GDB on remote
machine </span></font>
</h4>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use nc map the
KGTP interface to port 1024. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
su </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>nc
-l 1234 &lt;/sys/kernel/debug/gtp &gt;/sys/kernel/debug/gtp </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#(nc
-l -p 1234 &lt;/sys/kernel/debug/gtp &gt;/sys/kernel/debug/gtp for
old version netcat.) </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that, nc
will hang there to wait connection. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>Let
gdb connect to the port 1234. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gdb-release
./vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote xxx.xxx.xxx.xxx:1234</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that,
you can begin to use GDB command trace and debug the Linux Kernel. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4820_1369842245"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Android </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">This video
introduces use GDB connect to the KGTP in the Android, Please goto
<a href="#http://youtu.be/_UGN2j8Ctg0">http://youtu.be/_UGN2j8Ctg0</a>
or <a href="#http://www.tudou.com/programs/view/FjkQ6HhPnfE/">http://www.tudou.com/programs/view/FjkQ6HhPnfE/</a>
to see it. </span></font>
</p>
<h3 class="cjk"><a name="__RefHeading__4822_1369842245"></a><font face="DejaVu Serif, serif"><span lang="en-US">Insmod
the KGTP module </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>First</b>,
make sure ADB has connected with Android.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Second</b>,
copy KGTP module to Android. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
adb push gtp.ko /</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Directory &quot;/&quot;
may be read-only. You can choice other directory or use command &quot;sudo
adb shell mount -o rw,remount /&quot; remount the directory to can
write.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US"><b>Third</b>,
insmod the module. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>adb
shell insmod /gtp.ko</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4824_1369842245"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">Handle the issue
that cannot find &quot;/sys/kernel/debug/gtp&quot; </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you got
this issue, please make sure &quot;Debug Filesystem&quot; is opened
in your kernel config first.  Please goto 
If_your_system_use_the_Linux_kernel_that_is_built_by_yourself see
howto “<a href="#If use with Linux kernel of Android|outline">If
use with Linux kernel of Android</a>” see howto open it.</span></font></p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If it is
opened, please use following command mount sysfs. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
adb shell mount -t sysfs none /sys/</i></span></font></blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Maybe you will
got some error for examle &quot;Device or resource busy&quot;. Please
ignore it. </span></font>
</p>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">please use
following command mount debugfs. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
adb shell mount -t debugfs none /sys/kernel/debug/ </i></span></font>
</blockquote>
<p><br><br>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Then you can
find &quot;/sys/kernel/debug/gtp&quot;.</span></font></p>
<p><br><br>
</p>
<h3 class="cjk" style="page-break-before: always"><a name="__RefHeading__4826_1369842245"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">GDB connect to
the KGTP </span></font>
</h3>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Use nc map the
KGTP interface to port 1024. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>adb
forward tcp:1234 tcp:1234 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>adb
shell &quot;nc -l -p 1234 &lt;/sys/kernel/debug/gtp
&gt;/sys/kernel/debug/gtp&quot; </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#(adb
shell &quot;nc -l 1234 &lt;/sys/kernel/debug/gtp
&gt;/sys/kernel/debug/gtp&quot; for new version netcat.) </i></span></font>
</blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that, nc
will hang there to wait connection. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Let gdb
connect to the port 1234. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>gdb-release
./vmlinux </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
target remote :1234</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">After that,
you can begin to use GDB command trace and debug the Linux Kernel. </span></font>
</p>
<p><br><br>
</p>
<h1 class="cjk" style="page-break-before: always"><a name="__RefHeading__4828_1369842245"></a>
<font face="DejaVu Sans, sans-serif"><span lang="en-US">Appendix C
Add module symbols to GDB</span></font></h1>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Sometimes you
need to add a Linux kernel module's symbols to GDB to debug it. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Add symbols
with hand is not very easy, so KGTP package include an GDB python
script &quot;getmod.py&quot; and a program &quot;getmod&quot; can
help you. </span></font>
</p>
<p><br><br>
</p>
<h2 class="cjk"><a name="__RefHeading__4830_1369842245"></a><font face="DejaVu Serif, serif"><span lang="en-US">How
to use getmod </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">&quot;getmod&quot;
is written by C so you can use it anywhere even if in an embedded
environment. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">For example: </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#Following
command save Linux Kernel module info to the file /tmp/mi in GDB </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#command
format. </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
getmod &gt;/tmp/mi </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#in
gdb part: </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
source /tmp/mi </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>add
symbol table from file
&quot;/lib/modules/2.6.39-rc5+/kernel/fs/nls/nls_iso8859-1.ko&quot;
at </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.text_addr
= 0xf80de000 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.note.gnu.build-id_addr
= 0xf80de088 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.exit.text_addr
= 0xf80de074 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.init.text_addr
= 0xf8118000 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.rodata.str1.1_addr
= 0xf80de0ac </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.rodata_addr
= 0xf80de0c0 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>__mcount_loc_addr
= 0xf80de9c0 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.data_addr
= 0xf80de9e0 </i></span></font>
</blockquote>
<blockquote class="cjk">        <font face="DejaVu Serif, serif"><span lang="en-US"><i>.gnu.linkonce.this_module_addr
= 0xf80dea00 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#After
this GDB command, all the Linux Kernel module info is loaded into
GDB.</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p><font face="DejaVu Serif, serif"><span lang="en-US">If you use
remote debug or offline debug, maybe you need change the base
directory. Following example is for it. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>#/lib/modules/2.6.39-rc5+/kernel
is replaced to sudo ./getmod -r /home/teawater/kernel/b26 </i></span></font>
</blockquote>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>sudo
./getmod -r /home/teawater/kernel/b26 &gt;~/tmp/mi</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<h2 class="cjk" style="page-break-before: always"><a name="__RefHeading__4832_1369842245"></a>
<font face="DejaVu Serif, serif"><span lang="en-US">How to use
getmod.py </span></font>
</h2>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Please <b>note</b>
that static build GDB that download from
<a href="#https://code.google.com/p/gdbt/">https://code.google.com/p/gdbt/</a>
cannot use getmod.py. </span></font>
</p>
<p><font face="DejaVu Serif, serif"><span lang="en-US">Connect to
KGTP before use the getmod.py. </span></font>
</p>
<blockquote class="cjk"><font face="DejaVu Serif, serif"><span lang="en-US"><i>(gdb)
source ~/kgtp/getmod.py</i></span></font></blockquote>
<blockquote class="cjk" style="margin-left: 0cm"><br>
</blockquote>
<p style="margin-right: 1cm"><font face="DejaVu Serif, serif"><span lang="en-US">Then
this script will auto load the Linux kernel module's symbols to GDB. </span></font>
</p>
<div title="footer">
	<p align="center" style="margin-top: 0.5cm; margin-bottom: 0cm"><sdfield type=PAGE subtype=RANDOM format=PAGE><font face="DejaVu Serif, serif"><font size="3" style="font-size: 12pt">136</font></font></sdfield></p>
</div>
</body>
</html>
